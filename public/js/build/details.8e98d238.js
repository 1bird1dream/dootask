import{n as T}from"./app.49f07a13.js";var C=function(){var i,a,n,r,l,o,_,v,c,t=this,x=t.$createElement,e=t._self._c||x;return e("div",{staticClass:"review-details",style:{"z-index":t.modalTransferIndex}},[e("div",{staticClass:"review-details-box"},[e("h2",{staticClass:"review-details-title"},[e("span",[t._v(t._s(t.$L(t.datas.proc_def_name)))]),t.datas.state==0?e("Tag",{attrs:{color:"cyan"}},[t._v(t._s(t.$L("\u5F85\u5BA1\u6279")))]):t._e(),t.datas.state==1?e("Tag",{attrs:{color:"cyan"}},[t._v(t._s(t.$L("\u5BA1\u6279\u4E2D")))]):t._e(),t.datas.state==2?e("Tag",{attrs:{color:"green"}},[t._v(t._s(t.$L("\u5DF2\u901A\u8FC7")))]):t._e(),t.datas.state==3?e("Tag",{attrs:{color:"red"}},[t._v(t._s(t.$L("\u5DF2\u62D2\u7EDD")))]):t._e(),t.datas.state==4?e("Tag",{attrs:{color:"red"}},[t._v(t._s(t.$L("\u5DF2\u64A4\u56DE")))]):t._e()],1),e("h3",{staticClass:"review-details-subtitle"},[e("Avatar",{attrs:{src:t.datas.userimg,size:"24"}}),e("span",[t._v(t._s(t.datas.start_user_name))])],1),e("h3",{staticClass:"review-details-subtitle"},[e("span",[t._v(t._s(t.$L("\u63D0\u4EA4\u4E8E"))+" "+t._s(t.datas.start_time))])]),e("Divider"),(t.datas.proc_def_name||"").indexOf("\u73ED")==-1?e("div",{staticClass:"review-details-text"},[e("h4",[t._v(t._s(t.$L("\u5047\u671F\u7C7B\u578B")))]),e("p",[t._v(t._s(t.$L((i=t.datas.var)===null||i===void 0?void 0:i.type)))])]):t._e(),e("div",{staticClass:"review-details-text"},[e("h4",[t._v(t._s(t.$L("\u5F00\u59CB\u65F6\u95F4")))]),e("p",[t._v(t._s((a=t.datas.var)===null||a===void 0?void 0:a.start_time))])]),e("div",{staticClass:"review-details-text"},[e("h4",[t._v(t._s(t.$L("\u7ED3\u675F\u65F6\u95F4")))]),e("p",[t._v(t._s((n=t.datas.var)===null||n===void 0?void 0:n.end_time))])]),e("div",{staticClass:"review-details-text"},[e("h4",[t._v(t._s(t.$L("\u65F6\u957F"))+"\uFF08"+t._s(t.getTimeDifference((r=t.datas.var)===null||r===void 0?void 0:r.start_time,(l=t.datas.var)===null||l===void 0?void 0:l.end_time).unit)+"\uFF09")]),e("p",[t._v(t._s((o=t.datas.var)!==null&&o!==void 0&&o.start_time?t.getTimeDifference((_=t.datas.var)===null||_===void 0?void 0:_.start_time,(v=t.datas.var)===null||v===void 0?void 0:v.end_time).time:0))])]),e("div",{staticClass:"review-details-text"},[e("h4",[t._v(t._s(t.$L("\u8BF7\u5047\u4E8B\u7531")))]),e("p",[t._v(t._s((c=t.datas.var)===null||c===void 0?void 0:c.description))])]),e("Divider"),e("h3",{staticClass:"review-details-subtitle"},[t._v(t._s(t.$L("\u5BA1\u6279\u8BB0\u5F55")))]),e("Timeline",{staticStyle:{"margin-top":"20px"}},[t._l(t.datas.node_infos,function(s,d){var m,u,f,$,p,h,g,y,w;return[s.type=="starter"?e("TimelineItem",{key:d,attrs:{color:"green"}},[e("p",{staticClass:"timeline-title"},[t._v(t._s(t.$L("\u63D0\u4EA4")))]),e("div",{staticStyle:{display:"flex"}},[e("Avatar",{attrs:{src:t.data.userimg||t.datas.userimg,size:"38"}}),e("div",{staticStyle:{"margin-left":"10px",flex:"1"}},[e("p",{staticClass:"review-process-name"},[t._v(t._s(t.data.start_user_name||t.datas.start_user_name))]),e("p",{staticClass:"review-process-state"},[t._v(t._s(t.$L("\u5DF2\u63D0\u4EA4")))])]),e("div",{staticClass:"review-process-right"},[parseInt(t.getTimeAgo(s.claim_time))<t.showTimeNum?e("p",[t._v(t._s(t.getTimeAgo(s.claim_time)))]):t._e(),e("p",[t._v(t._s((m=s.claim_time)===null||m===void 0?void 0:m.substr(0,16)))])])],1)]):t._e(),s.type=="approver"&&s._show?e("TimelineItem",{key:d,attrs:{color:s.identitylink?((u=s.identitylink)===null||u===void 0?void 0:u.state)>1?"#f03f3f":"green":"#ccc"}},[e("p",{staticClass:"timeline-title"},[t._v(t._s(t.$L("\u5BA1\u6279")))]),e("div",{staticStyle:{display:"flex"}},[e("Avatar",{attrs:{src:s.node_user_list&&((f=s.node_user_list[0])===null||f===void 0?void 0:f.userimg)||s.userimg,size:"38"}}),e("div",{staticStyle:{"margin-left":"10px",flex:"1"}},[e("p",{staticClass:"review-process-name"},[t._v(t._s(s.approver))]),s.identitylink?t._e():e("p",{staticClass:"review-process-state",staticStyle:{color:"#6d6d6d"}},[t._v("\u5F85\u5BA1\u6279")]),s.identitylink?e("p",{staticClass:"review-process-state"},[s.identitylink.state==0?e("span",{staticStyle:{color:"#496dff"}},[t._v(t._s(t.$L("\u5BA1\u6279\u4E2D")))]):t._e(),s.identitylink.state==1?e("span",[t._v(t._s(t.$L("\u5DF2\u901A\u8FC7")))]):t._e(),s.identitylink.state==2?e("span",{staticStyle:{color:"#f03f3f"}},[t._v(t._s(t.$L("\u5DF2\u62D2\u7EDD")))]):t._e(),s.identitylink.state==3?e("span",{staticStyle:{color:"#f03f3f"}},[t._v(t._s(t.$L("\u5DF2\u64A4\u56DE")))]):t._e()]):t._e()]),e("div",{staticClass:"review-process-right"},[parseInt(t.getTimeAgo(s.claim_time))<t.showTimeNum?e("p",[t._v(" "+t._s((($=s.identitylink)===null||$===void 0?void 0:$.state)==0?t.$L("\u5DF2\u7B49\u5F85")+" "+t.getTimeAgo(t.datas.node_infos[d-1].claim_time,2):s.claim_time?t.getTimeAgo(s.claim_time):"")+" ")]):t._e(),e("p",[t._v(t._s((p=s.claim_time)===null||p===void 0?void 0:p.substr(0,16)))])])],1),(h=s.identitylink)!==null&&h!==void 0&&h.comment?e("p",{staticClass:"comment"},[t._v("\u201C"+t._s((g=s.identitylink)===null||g===void 0?void 0:g.comment)+"\u201D")]):t._e()]):t._e(),s.type=="notifier"&&s._show?e("TimelineItem",{key:d,attrs:{color:s.is_finished?"green":"#ccc"}},[e("p",{staticClass:"timeline-title"},[t._v(t._s(t.$L("\u6284\u9001")))]),e("div",{staticStyle:{display:"flex"}},[e("Avatar",{attrs:{src:"/images/avatar/default_bot.png",size:"38"}}),e("div",{staticStyle:{"margin-left":"10px",flex:"1"}},[e("p",{staticClass:"review-process-name"},[t._v(t._s(t.$L("\u7CFB\u7EDF")))]),e("p",{staticStyle:{"font-size":"12px"}},[t._v(t._s(t.$L("\u81EA\u52A8\u6284\u9001"))+" "),e("span",{staticStyle:{color:"#486fed"}},[t._v(" "+t._s((y=s.node_user_list)===null||y===void 0?void 0:y.map(function(k){return k.name}).join(","))+" "+t._s(t.$L("\u7B49"+((w=s.node_user_list)===null||w===void 0?void 0:w.length)+"\u4EBA"))+" ")])])])],1)]):t._e(),s.aprover_type=="end"?e("TimelineItem",{key:d,attrs:{color:s.is_finished?"green":"#ccc"}},[e("p",{staticClass:"timeline-title"},[t._v(t._s(t.$L("\u7ED3\u675F")))]),e("div",{staticStyle:{display:"flex"}},[e("Avatar",{attrs:{src:"/images/avatar/default_bot.png",size:"38"}}),e("div",{staticStyle:{"margin-left":"10px",flex:"1"}},[e("p",{staticClass:"review-process-name"},[t._v(t._s(t.$L("\u7CFB\u7EDF")))]),e("p",{staticStyle:{"font-size":"12px"}},[t._v(" "+t._s(t.datas.is_finished?t.$L("\u5DF2\u7ED3\u675F"):t.$L("\u672A\u7ED3\u675F")))])])],1)]):t._e()]})],2)],1),t.datas.state<=1?e("div",{staticClass:"review-operation"},[e("div",{staticStyle:{flex:"1"}}),(t.datas.candidate||"").split(",").indexOf(t.userId+"")!=-1?e("Button",{attrs:{type:"success"},on:{click:function(s){return t.approve(1)}}},[t._v(t._s(t.$L("\u540C\u610F")))]):t._e(),(t.datas.candidate||"").split(",").indexOf(t.userId+"")!=-1?e("Button",{attrs:{type:"error"},on:{click:function(s){return t.approve(2)}}},[t._v(t._s(t.$L("\u62D2\u7EDD")))]):t._e(),t.isShowWarningBtn?e("Button",{attrs:{type:"warning"},on:{click:t.revocation}},[t._v(t._s(t.$L("\u64A4\u9500")))]):t._e()],1):t._e()])},I=[];const S={name:"details",props:{data:{type:Object,default(){return{}}}},data(){return{modalTransferIndex:window.modalTransferIndex,datas:{},showTimeNum:24}},watch:{$route(i,a){i.name=="manage-review-details"&&this.init()},data:{handler(i,a){i.id&&this.getInfo()},deep:!0}},computed:{isShowWarningBtn(){let i=this.userId==this.datas.start_user_id;return(this.datas.node_infos||[]).map(a=>{a.type!="starter"&&a.is_finished==!0&&a.identitylink.userid!=this.userId&&(i=!1)}),i}},mounted(){this.init()},methods:{init(){this.modalTransferIndex=window.modalTransferIndex=window.modalTransferIndex+1,this.$route.query.id&&(this.data.id=this.$route.query.id,this.getInfo())},getTimeAgo(i,a){const r=(new Date-new Date(i))/1e3;if(r<60)return a==2?"0"+this.$L("\u5206\u949F"):this.$L("\u521A\u521A");if(r<3600){const l=Math.floor(r/60);return a==2?`${l}${this.$L("\u5206\u949F")}`:`${l} ${this.$L("\u5206\u949F\u524D")}`}else if(r<3600*24){const l=Math.floor(r/3600);return a==2?`${l}${this.$L("\u5C0F\u65F6")}`:`${l} ${this.$L("\u5C0F\u65F6\u524D")}`}else{const l=Math.floor(r/3600/24);return a==2?`${l}${this.$L("\u5929")}`:`${l} ${this.$L("\u5929")}`}},getTimeDifference(i,a){const r=(new Date(a)-new Date(i))/1e3;return r<60?{time:r,unit:this.$L("\u79D2")}:r<3600?{time:Math.floor(r/60),unit:this.$L("\u5206\u949F")}:r<3600*24?{time:Math.floor(r/3600),unit:this.$L("\u5C0F\u65F6")}:{time:Math.floor(r/3600/24),unit:this.$L("\u5929")}},getInfo(){this.datas=this.data,this.$store.dispatch("call",{method:"get",url:"workflow/process/detail",data:{id:this.data.id}}).then(({data:i})=>{var a=!0;i.node_infos=i.node_infos.map(n=>{var r,l;return n._show=a,(((r=n.identitylink)==null?void 0:r.state)==2||((l=n.identitylink)==null?void 0:l.state)==3)&&(a=!1),n}),this.datas=i}).catch(({msg:i})=>{$A.modalError(i)}).finally(i=>{this.loadIng--})},approve(i){$A.modalInput({title:"\u5BA1\u6279",placeholder:"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1",type:"textarea",okText:i==1?"\u540C\u610F":"\u62D2\u7EDD",onOk:a=>i!=1&&!a?"\u8BF7\u8F93\u5165\u5BA1\u6279\u610F\u89C1":(this.$store.dispatch("call",{url:"workflow/task/complete",data:{task_id:this.datas.task_id,pass:i==1,comment:a}}).then(({msg:n})=>{$A.messageSuccess(n),this.$route.name=="manage-review-details"||this.$route.name=="manage-messenger"?this.getInfo():this.$emit("approve")}).catch(({msg:n})=>{$A.modalError(n)}),!1)})},revocation(){$A.modalConfirm({content:"\u4F60\u786E\u5B9A\u8981\u64A4\u9500\u5417\uFF1F",loading:!0,onOk:()=>new Promise((i,a)=>(this.$store.dispatch("call",{url:"workflow/task/withdraw",data:{task_id:this.datas.task_id,proc_inst_id:this.datas.id}}).then(({msg:n})=>{$A.messageSuccess(n),i(),this.$route.name=="manage-review-details"||this.$route.name=="manage-messenger"?this.getInfo():this.$emit("revocation")}).catch(({msg:n})=>{$A.modalError(n),i()}),!1))})}}},L={};var A=T(S,C,I,!1,D,null,null,null);function D(i){for(let a in L)this[a]=L[a]}var z=function(){return A.exports}();export{z as default};
