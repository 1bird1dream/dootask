"use strict";(self.webpackChunkDooTask=self.webpackChunkDooTask||[]).push([[226],{26167:(t,e,a)=>{a.d(e,{Z:()=>n});var i=a(1519),s=a.n(i)()((function(t){return t[1]}));s.push([t.id,'.component-resize-line[data-v-eaab078e]{cursor:col-resize}@media (max-width:768px){.component-resize-line[data-v-eaab078e]{display:none}}.component-resize-line.resizing[data-v-eaab078e]:after{bottom:0;content:"";cursor:col-resize;left:0;position:fixed;right:0;top:0;z-index:99999}.component-resize-line.bottom[data-v-eaab078e],.component-resize-line.bottom[data-v-eaab078e]:after{cursor:row-resize}',""]);const n=s},70631:(t,e,a)=>{a.d(e,{Z:()=>g});const i={name:"ResizeLine",props:{value:{},min:{type:Number,default:100},max:{type:Number,default:600},placement:{validator:function(t){return["right","bottom"].includes(t)},default:"bottom"},reverse:{type:Boolean,default:!1}},data:function(){return{resizing:!1,mouseX:0,mouseY:0,offset:{},tmpSize:void 0}},mounted:function(){document.documentElement.addEventListener("mousemove",this.handleMove,!0),document.documentElement.addEventListener("mouseup",this.handleUp,!0)},methods:{resizeDown:function(t){this.mouseX=t.pageX||t.clientX+document.documentElement.scrollLeft,this.mouseY=t.pageY||t.clientY+document.documentElement.scrollTop,this.offset={left:t.target.offsetLeft,top:t.target.offsetTop},this.resizing=!0,"number"==typeof this.value&&(this.tmpSize=this.value),this.$emit("on-change",{event:"down"})},handleMove:function(t){if(this.resizing){var e,a=(t.pageX||t.clientX+document.documentElement.scrollLeft)-this.mouseX,i=(t.pageY||t.clientY+document.documentElement.scrollTop)-this.mouseY;if("number"==typeof this.tmpSize)e="bottom"==this.placement?this.reverse?this.tmpSize-i:this.tmpSize+i:this.reverse?this.tmpSize-a:this.tmpSize+a,this.min>0&&(e=Math.max(this.min,e)),this.max>0&&(e=Math.min(this.max,e)),this.$emit("input",e);this.$emit("on-change",{event:"move",diff:{x:a,y:i},offset:this.offset})}},handleUp:function(){this.resizing=!1,this.tmpSize=void 0,this.$emit("on-change",{event:"up"})}}};var s=a(93379),n=a.n(s),o=a(26167),r={insert:"head",singleton:!1};n()(o.Z,r);o.Z.locals;var c=a(51900);const l=(0,c.Z)(i,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{staticClass:"component-resize-line",class:[t.resizing?"resizing":"",t.placement],on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:(e.stopPropagation(),e.preventDefault(),t.resizeDown.apply(null,arguments))}}})}),[],!1,null,"eaab078e",null).exports;function d(t){return void 0===t&&(t=document.body),!0===t?document.body:t instanceof window.Node?t:document.querySelector(t)}const u={inserted:function(t,e,a){var i=e.value;if(t.dataset&&"true"!==t.dataset.transfer)return!1;t.className=t.className?t.className+" v-transfer-dom":"v-transfer-dom";var s=t.parentNode;if(s){var n=document.createComment(""),o=!1;!1!==i&&(s.replaceChild(n,t),d(i).appendChild(t),o=!0),t.__transferDomData||(t.__transferDomData={parentNode:s,home:n,target:d(i),hasMovedOut:o})}},componentUpdated:function(t,e){var a=e.value;if(t.dataset&&"true"!==t.dataset.transfer)return!1;var i=t.__transferDomData;if(i){var s=i.parentNode,n=i.home,o=i.hasMovedOut;!o&&a?(s.replaceChild(n,t),d(a).appendChild(t),t.__transferDomData=Object.assign({},t.__transferDomData,{hasMovedOut:!0,target:d(a)})):o&&!1===a?(s.replaceChild(t,n),t.__transferDomData=Object.assign({},t.__transferDomData,{hasMovedOut:!1,target:d(a)})):a&&d(a).appendChild(t)}},unbind:function(t){if(t.dataset&&"true"!==t.dataset.transfer)return!1;t.className=t.className.replace("v-transfer-dom",""),t.__transferDomData&&(!0===t.__transferDomData.hasMovedOut&&t.__transferDomData.parentNode&&t.__transferDomData.parentNode.appendChild(t),t.__transferDomData=null)}};var p=a(20629);function h(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?h(Object(a),!0).forEach((function(e){f(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function f(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const v={name:"DrawerOverlay",components:{ResizeLine:l},directives:{TransferDom:u},props:{value:{type:Boolean,default:!1},maskClosable:{type:Boolean,default:!0},escClosable:{type:Boolean,default:!0},placement:{validator:function(t){return["right","bottom"].includes(t)},default:"bottom"},size:{type:[Number,String],default:"100%"},minSize:{type:Number,default:300},resize:{type:Boolean,default:!0},transfer:{type:Boolean,default:!1},beforeClose:Function},data:function(){return{dynamicSize:0,zIndex:0}},mounted:function(){document.addEventListener("keydown",this.escClose)},beforeDestroy:function(){document.removeEventListener("keydown",this.escClose)},computed:m(m({},(0,p.rn)(["cacheDrawerIndex"])),{},{overlayStyle:function(){return{zIndex:1e3+this.zIndex}},bodyStyle:function(){var t=this.dynamicSize;return t="".concat(t,t<=100?"%":"px"),"right"==this.placement?{width:t,height:"100%"}:{width:"100%",height:t}}}),watch:{value:function(t){var e=this;if(this._uid){var a=this.$store.state.cacheDrawerOverlay.findIndex((function(t){return t._uid===e._uid}));t&&-1===a&&this.$store.state.cacheDrawerOverlay.push({_uid:this._uid,close:this.close}),!t&&a>-1&&this.$store.state.cacheDrawerOverlay.splice(a,1)}t?this.zIndex=this.$store.state.cacheDrawerIndex++:0===this.$store.state.cacheDrawerOverlay.length&&(this.$store.state.cacheDrawerIndex=0)},size:{handler:function(t){this.dynamicSize=parseInt(t)},immediate:!0}},methods:{mask:function(){this.maskClosable&&this.close()},close:function(){if(!this.beforeClose)return this.handleClose();var t=this.beforeClose();t&&t.then?t.then(this.handleClose):this.handleClose()},handleClose:function(){this.$emit("input",!1)},escClose:function(t){if(this.value&&this.escClosable&&27===t.keyCode){if(this.$Modal.visibles().length>0)return;var e=this.$store.state.cacheDrawerOverlay;if(e.length>0)e[e.length-1].close()}}}};const g=(0,c.Z)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"transfer-dom",rawName:"v-transfer-dom"}],class:["drawer-overlay",t.placement,t.value?"overlay-visible":"overlay-hide"],style:t.overlayStyle,attrs:{"data-transfer":t.transfer}},[a("div",{staticClass:"overlay-mask",on:{click:t.mask}}),t._v(" "),a("div",{staticClass:"overlay-body",style:t.bodyStyle},[a("div",{staticClass:"overlay-close"},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return e.stopPropagation(),t.close.apply(null,arguments)}}},[a("svg",{staticClass:"icon fill-current",attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 26 26",fill:"none",role:"img"}},[a("path",{attrs:{d:"M8.28596 6.51819C7.7978 6.03003 7.00634 6.03003 6.51819 6.51819C6.03003 7.00634 6.03003 7.7978 6.51819 8.28596L11.2322 13L6.51819 17.714C6.03003 18.2022 6.03003 18.9937 6.51819 19.4818C7.00634 19.97 7.7978 19.97 8.28596 19.4818L13 14.7678L17.714 19.4818C18.2022 19.97 18.9937 19.97 19.4818 19.4818C19.97 18.9937 19.97 18.2022 19.4818 17.714L14.7678 13L19.4818 8.28596C19.97 7.7978 19.97 7.00634 19.4818 6.51819C18.9937 6.03003 18.2022 6.03003 17.714 6.51819L13 11.2322L8.28596 6.51819Z",fill:"currentColor"}})])])]),t._v(" "),t.resize?a("ResizeLine",{staticClass:"overlay-resize",attrs:{placement:t.placement,min:t.minSize,max:0,reverse:""},model:{value:t.dynamicSize,callback:function(e){t.dynamicSize=e},expression:"dynamicSize"}}):t._e(),t._v(" "),a("div",{staticClass:"overlay-content"},[t._t("default")],2)],1)])}),[],!1,null,null,null).exports},99226:(t,e,a)=>{a.r(e),a.d(e,{default:()=>V});var i=a(20629),s=a(70786);function n(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function o(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const r={name:"ProjectArchived",data:function(){return{loadIng:0,keys:{},columns:[],list:[],page:1,pageSize:20,total:0,noText:""}},mounted:function(){this.getLists()},computed:function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?n(Object(a),!0).forEach((function(e){o(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},(0,i.rn)(["windowMax768"])),methods:{initLanguage:function(){var t=this;this.columns=[{title:this.$L("ID"),key:"id",minWidth:50,maxWidth:70},{title:this.$L("项目名称"),key:"name",minWidth:200,render:function(t,e){return t("AutoTip",e.row.name)}},{title:this.$L("归档时间"),key:"archived_at",width:168},{title:this.$L("归档会员"),key:"archived_userid",minWidth:80,render:function(e,a){var i=a.row;return i.archived_userid?e("UserAvatar",{props:{userid:i.archived_userid,size:24,showName:!0}}):e("Tag",t.$L("系统自动"))}},{title:this.$L("负责人"),minWidth:80,render:function(t,e){return t("UserAvatar",{props:{showName:!0,size:22,userid:e.row.owner_userid}})}},{title:this.$L("操作"),align:"center",width:100,render:function(e,a){var i=e("Poptip",{props:{title:t.$L("你确定要还原归档吗？"),confirm:!0,transfer:!0,placement:"left"},style:{fontSize:"13px",cursor:"pointer",color:"#8bcf70"},on:{"on-ok":function(){t.recovery(a.row)}}},t.$L("还原")),s=e("Poptip",{props:{title:t.$L("你确定要删除项目吗？"),confirm:!0,transfer:!0,placement:"left"},style:{marginLeft:"6px",fontSize:"13px",cursor:"pointer",color:"#f00"},on:{"on-ok":function(){t.delete(a.row)}}},t.$L("删除"));return e("TableAction",{props:{column:a.column}},[i,s])}}]},refresh:function(){this.keys=[],this.getLists()},getLists:function(){var t=this;this.loadIng++,this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,archived:"yes",page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),20)}}).then((function(e){var a=e.data;t.loadIng--,t.page=a.current_page,t.total=a.total,t.list=a.data,t.noText="没有相关的数据"})).catch((function(){t.loadIng--,t.noText="数据加载失败"}))},setPage:function(t){this.page=t,this.getLists()},setPageSize:function(t){this.page=1,this.pageSize=t,this.getLists()},recovery:function(t){var e=this;this.list=this.list.filter((function(e){return e.id!=t.id})),this.loadIng++,this.$store.dispatch("call",{url:"project/archived",data:{project_id:t.id,type:"recovery"}}).then((function(){e.loadIng--,e.getLists(),e.$store.dispatch("getProjectOne",t.id).catch((function(){}))})).catch((function(t){var a=t.msg;$A.modalError(a),e.loadIng--,e.getLists()}))},delete:function(t){var e=this;this.list=this.list.filter((function(e){return e.id!=t.id})),this.loadIng++,this.$store.dispatch("removeProject",t.id).then((function(t){var a=t.msg;$A.messageSuccess(a),e.loadIng--,e.getLists()})).catch((function(t){var a=t.msg;$A.modalError(a),e.loadIng--,e.getLists()}))}}};var c=a(51900);const l=(0,c.Z)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-archived"},[a("div",{staticClass:"archived-title"},[t._v("\n        "+t._s(t.$L("归档的项目"))+"\n        "),a("div",{staticClass:"title-icon"},[t.loadIng>0?a("Loading"):t._e()],1)]),t._v(" "),a("div",{staticClass:"search-container lr"},[a("ul",[a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("项目名"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(e){t.$set(t.keys,"name",e)},expression:"keys.name"}})],1)]),t._v(" "),a("li",{staticClass:"search-button"},[a("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[a("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.getLists}},[t._v(t._s(t.$L("搜索")))]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.refresh}},[t._v(t._s(t.$L("刷新")))])],1)],1)],1)])]),t._v(" "),a("Table",{attrs:{columns:t.columns,data:t.list,"no-data-text":t.$L(t.noText)}}),t._v(" "),a("Page",{staticClass:"page-container",attrs:{total:t.total,current:t.page,pageSize:t.pageSize,disabled:t.loadIng>0,simple:t.windowMax768,showTotal:""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)}),[],!1,null,null,null).exports,d=(t,e)=>!(!t||!e)&&("String"===t?"string"==typeof e:"Object"===t?"[object Object]"===Object.prototype.toString.call(e):"number"===t?"number"==typeof e:"function"===t&&"[object Function]"===Object.prototype.toString.call(e)),u=(t,e,a)=>t.findIndex((t=>t[e]===a));const p=class{constructor(t="默认标题",e={}){this.title=t,this.options=e,this.support=!1,this.supportFn()}supportFn(){window.Notification?(this.initStatus(),this.support=!0):this.support=!1}initStatus(){this.notification=null,this.state=Notification.permission,this.msg=null,this.callBackObj={},this.notificationAll=[],this.requireInteractionTimeout=!1,this.timeout=null}initNotification(t){if(this.checkStatus("support")){if(!d("function",t))return console.error("initNotification的参数必须为函数");if("granted"===this.state)this.msg="already granted";else if("default"===this.state){const e=e=>(this.state=e,this.msg="granted"===e?"granted":"default"===e?"close":"denied",t(this.msg));try{Notification.requestPermission().then(e)}catch(t){Notification.requestPermission(e)}}else this.msg="already denied";return"default"!==this.state?t(this.msg):void 0}}userAgreed(){if(this.checkStatus("userAgreed")){this.notification=new Notification(this.title,this.options),this.notificationWatch();for(const t in this.callBackObj)this.notification[t]=e=>{this.callBackObj[t](e)}}}notificationTimeoutFn(t){t&&d("number",t)?this.timeout=t:this.timeout=5e3}notificationWatch(){this.notificationAll.push(this.notification),this.notification.requireInteraction?this.everyTimeout():this.autoClose(),this.watchClose()}everyTimeout(){d("number",this.timeout)&&(this.options.timeOut&&d("number",this.options.timeOut)?this.timeoutCloseFn(this.options.timeOut):this.timeoutCloseFn(this.timeout))}timeoutCloseFn(t){const e=this.notification.timestamp;setTimeout((()=>{const t=u(this.notificationAll,"timestamp",e);-1!==t&&this.notificationAll[t].close()}),t)}watchClose(){const t=this.notification.timestamp;this.notification.addEventListener("close",(e=>{const a=u(this.notificationAll,"timestamp",t);-1!==a&&this.notificationAll.splice(a,1)}))}autoClose(){const t=this.notification.timestamp;setTimeout((()=>{const e=u(this.notificationAll,"timestamp",t);-1!==e&&this.notificationAll.splice(e,1)}),6e3)}notificationEvent(t){if(this.checkStatus("support")){if(!d("Object",t))return console.error("callObj必须为对象");for(const e in t)if(!d("function",t[e]))return console.error("callObj对象中的每个value必须为函数");this.callBackObj=t}}closeAll(){for(let t of this.notificationAll.values())t.close();this.notificationAll=[]}close(){if(!this.notification)return console.warn("this.notification为null,通知尚未调用/用户未同意显示通知");this.notification.close()}updateOptions(t){if(t&&d("Object",t))for(const e in t)this.options[e]=t[e];else console.warn("updateOptions参数错误：options为必填对象")}replaceTitle(t){t&&d("String",t)?this.title=t:console.warn("replaceTitle: title(通知标题)为必填字符串")}replaceOptions(t){t&&d("Object",t)?this.options=t:console.warn("replaceOptions参数错误：options为必填对象")}checkStatus(t){if("support"===t){if(!this.support)return console.warn("用户浏览器不支持"),!1}else if("userAgreed"===t){if("granted"!==this.state)return!1;if(!this.checkStatus("support"))return!1}return!0}};function h(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function m(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const f={name:"TeamManagement",data:function(){return{loadIng:0,keys:{},columns:[],list:[],page:1,pageSize:20,total:0,noText:""}},mounted:function(){this.getLists()},computed:function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?h(Object(a),!0).forEach((function(e){m(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):h(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},(0,i.rn)(["windowMax768"])),methods:{initLanguage:function(){var t=this;this.columns=[{title:this.$L("ID"),minWidth:50,maxWidth:70,key:"userid"},{title:this.$L("邮箱"),key:"email",minWidth:100,render:function(e,a){var i=a.row,s=[e("AutoTip",i.email)],n=i.identity;return n.includes("admin")&&s.push(e("Tag",{props:{color:"warning"}},t.$L("管理员"))),n.includes("disable")&&s.push(e("Tag",{props:{color:"error"}},t.$L("禁用"))),e("div",{class:"team-email"},s)}},{title:this.$L("昵称"),key:"nickname",minWidth:80,render:function(e,a){var i=a.row;return e("QuickEdit",{props:{value:i.nickname_original},on:{"on-update":function(e,a){t.operationUser({userid:i.userid,nickname:e}).then(a)}}},[e("AutoTip",i.nickname_original||"-")])}},{title:this.$L("职位/职称"),key:"profession",minWidth:80,render:function(e,a){var i=a.row;return e("QuickEdit",{props:{value:i.profession},on:{"on-update":function(e,a){t.operationUser({userid:i.userid,profession:e}).then(a)}}},[e("AutoTip",i.profession||"-")])}},{title:this.$L("最后在线"),key:"line_at",width:168},{title:this.$L("操作"),align:"center",width:100,render:function(e,a){var i=a.row.identity,s=[];i.includes("admin")?s.push(e("EDropdownItem",{props:{command:"clearadmin"}},[e("div",t.$L("取消管理员"))])):s.push(e("EDropdownItem",{props:{command:"setadmin"}},[e("div",t.$L("设为管理员"))])),i.includes("disable")?s.push(e("EDropdownItem",{props:{command:"cleardisable"}},[e("div",t.$L("取消禁用"))])):s.push(e("EDropdownItem",{props:{command:"setdisable"}},[e("div",t.$L("设为禁用"))])),s.push.apply(s,[e("EDropdownItem",{props:{command:"password"}},[e("div",t.$L("修改密码"))]),e("EDropdownItem",{props:{command:"delete"},style:{color:"red"}},[e("div",t.$L("删除"))])]);var n=e("EDropdown",{props:{size:"small",trigger:"click"},on:{command:function(e){t.dropUser(e,a.row)}}},[e("Button",{props:{type:"primary",size:"small"},style:{fontSize:"12px"}},t.$L("操作")),e("EDropdownMenu",{slot:"dropdown"},[s])]);return e("TableAction",{props:{column:a.column}},[n])}}]},getLists:function(){var t=this;this.loadIng++,this.$store.dispatch("call",{url:"users/lists",data:{keys:this.keys,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),20)}}).then((function(e){var a=e.data;t.loadIng--,t.page=a.current_page,t.total=a.total,t.list=a.data,t.noText="没有相关的数据"})).catch((function(){t.loadIng--,t.noText="数据加载失败"}))},setPage:function(t){this.page=t,this.getLists()},setPageSize:function(t){this.page=1,this.pageSize=t,this.getLists()},dropUser:function(t,e){var a=this;switch(t){case"password":$A.modalInput({title:"修改密码",placeholder:"请输入新的密码",onOk:function(t){return t&&a.operationUser({userid:e.userid,password:t}),!0}});break;case"delete":$A.modalConfirm({content:"你确定要删除此帐号吗？",onOk:function(){a.operationUser({userid:e.userid,type:t})}});break;default:this.operationUser({userid:e.userid,type:t})}},operationUser:function(t){var e=this;return new Promise((function(a){e.loadIng++,e.$store.dispatch("call",{url:"users/operation",data:t}).then((function(t){var i=t.msg;$A.messageSuccess(i),e.loadIng--,e.getLists(),a()})).catch((function(t){var i=t.msg;$A.modalError(i,301),e.loadIng--,e.getLists(),a()}))}))}}};const v=(0,c.Z)(f,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"team-management"},[a("div",{staticClass:"management-title"},[t._v("\n        "+t._s(t.$L("团队管理"))+"\n        "),a("div",{staticClass:"title-icon"},[t.loadIng>0?a("Loading"):t._e()],1)]),t._v(" "),a("div",{staticClass:"search-container lr"},[a("ul",[a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("邮箱"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Input",{attrs:{clearable:""},model:{value:t.keys.email,callback:function(e){t.$set(t.keys,"email",e)},expression:"keys.email"}})],1)]),t._v(" "),a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("昵称"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Input",{attrs:{clearable:""},model:{value:t.keys.nickname,callback:function(e){t.$set(t.keys,"nickname",e)},expression:"keys.nickname"}})],1)]),t._v(" "),a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("职位/职称"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Input",{attrs:{clearable:""},model:{value:t.keys.position,callback:function(e){t.$set(t.keys,"position",e)},expression:"keys.position"}})],1)]),t._v(" "),a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("身份"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Select",{model:{value:t.keys.identity,callback:function(e){t.$set(t.keys,"identity",e)},expression:"keys.identity"}},[a("Option",{attrs:{value:""}},[t._v(t._s(t.$L("全部")))]),t._v(" "),a("Option",{attrs:{value:"admin"}},[t._v(t._s(t.$L("管理员")))]),t._v(" "),a("Option",{attrs:{value:"disable"}},[t._v(t._s(t.$L("禁用")))]),t._v(" "),a("Option",{attrs:{value:"noadmin"}},[t._v(t._s(t.$L("非管理员")))]),t._v(" "),a("Option",{attrs:{value:"nodisable"}},[t._v(t._s(t.$L("非禁用")))])],1)],1)]),t._v(" "),a("li",{staticClass:"search-button"},[a("Tooltip",{attrs:{theme:"light",placement:"bottom","transfer-class-name":"search-button-clear",transfer:""}},[a("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.getLists}},[t._v(t._s(t.$L("搜索")))]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("刷新")))])],1)],1)],1)])]),t._v(" "),a("Table",{attrs:{columns:t.columns,data:t.list,"no-data-text":t.$L(t.noText)}}),t._v(" "),a("Page",{staticClass:"page-container",attrs:{total:t.total,current:t.page,pageSize:t.pageSize,disabled:t.loadIng>0,simple:t.windowMax768,showTotal:""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)}),[],!1,null,null,null).exports;function g(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function b(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const y={name:"ProjectManagement",data:function(){return{loadIng:0,keys:{},columns:[],list:[],page:1,pageSize:20,total:0,noText:""}},mounted:function(){this.getLists()},computed:function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?g(Object(a),!0).forEach((function(e){b(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},(0,i.rn)(["windowMax768"])),methods:{initLanguage:function(){var t=this;this.columns=[{title:this.$L("ID"),key:"id",minWidth:50,maxWidth:70},{title:this.$L("项目名称"),key:"name",minWidth:100,render:function(e,a){var i=a.row,s=[e("AutoTip",i.name)];return i.archived_at&&s.push(e("Tag",{props:{color:"error"}},t.$L("已归档"))),e("div",{class:"project-name"},s)}},{title:this.$L("项目进度"),minWidth:100,render:function(t,e){var a=e.row,i=[t("AutoTip",a.task_complete+"/"+a.task_num),t("Progress",{props:{percent:a.task_percent,strokeWidth:5}})];return t("div",{class:"project-percent"},i)}},{title:this.$L("负责人"),minWidth:80,render:function(t,e){return t("UserAvatar",{props:{showName:!0,size:22,userid:e.row.owner_userid}})}},{title:this.$L("创建人"),minWidth:80,render:function(t,e){return t("UserAvatar",{props:{showName:!0,size:22,userid:e.row.userid}})}},{title:this.$L("创建时间"),key:"created_at",width:168}]},getLists:function(){var t=this,e="all";"archived"==this.keys.status?e="yes":"unarchived"==this.keys.status&&(e="no"),this.loadIng++,this.$store.dispatch("call",{url:"project/lists",data:{keys:this.keys,all:1,archived:e,page:Math.max(this.page,1),pagesize:Math.max($A.runNum(this.pageSize),20)}}).then((function(e){var a=e.data;t.loadIng--,t.page=a.current_page,t.total=a.total,t.list=a.data,t.noText="没有相关的数据"})).catch((function(){t.loadIng--,t.noText="数据加载失败"}))},setPage:function(t){this.page=t,this.getLists()},setPageSize:function(t){this.page=1,this.pageSize=t,this.getLists()}}};const _=(0,c.Z)(y,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-management"},[a("div",{staticClass:"management-title"},[t._v("\n        "+t._s(t.$L("所有项目"))+"\n        "),a("div",{staticClass:"title-icon"},[t.loadIng>0?a("Loading"):t._e()],1)]),t._v(" "),a("div",{staticClass:"search-container lr"},[a("ul",[a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("项目名"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Input",{attrs:{clearable:""},model:{value:t.keys.name,callback:function(e){t.$set(t.keys,"name",e)},expression:"keys.name"}})],1)]),t._v(" "),a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("项目状态"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Select",{model:{value:t.keys.status,callback:function(e){t.$set(t.keys,"status",e)},expression:"keys.status"}},[a("Option",{attrs:{value:""}},[t._v(t._s(t.$L("全部")))]),t._v(" "),a("Option",{attrs:{value:"unarchived"}},[t._v(t._s(t.$L("未归档")))]),t._v(" "),a("Option",{attrs:{value:"archived"}},[t._v(t._s(t.$L("已归档")))])],1)],1)]),t._v(" "),a("li",{staticClass:"search-button"},[a("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[a("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.getLists}},[t._v(t._s(t.$L("搜索")))]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("刷新")))])],1)],1)],1)])]),t._v(" "),a("Table",{attrs:{columns:t.columns,data:t.list,"no-data-text":t.$L(t.noText)}}),t._v(" "),a("Page",{staticClass:"page-container",attrs:{total:t.total,current:t.page,pageSize:t.pageSize,disabled:t.loadIng>0,simple:t.windowMax768,showTotal:""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)}),[],!1,null,null,null).exports;var w=a(70631);const k={name:"DragBallComponent",props:{id:{type:String,default:""},distanceLeft:{type:Number,default:-1},distanceRight:{type:Number,default:0},distanceTop:{type:Number,default:-1},distanceBottom:{type:Number,default:100},isScrollHidden:{type:Boolean,default:!1},isCanDraggable:{type:Boolean,default:!0},zIndex:{type:Number,default:50}},data:function(){return{clientWidth:null,clientHeight:null,top:0,left:0,timer:null,currentTop:0,isMoving:!1,record:{}}},created:function(){this.clientWidth=document.documentElement.clientWidth,this.clientHeight=document.documentElement.clientHeight},mounted:function(){var t=this;this.id&&($A.isJson(window._DragBallComponent)||(window._DragBallComponent={})),this.isCanDraggable&&this.$nextTick((function(){t.id&&$A.isJson(window._DragBallComponent[t.id])?(t.left=window._DragBallComponent[t.id].left,t.top=window._DragBallComponent[t.id].top):(t.distanceLeft>-1?t.left=t.distanceLeft:t.left=t.clientWidth-t.floatDrag.offsetWidth-t.distanceRight,t.distanceTop>-1?t.top=t.distanceTop:t.top=t.clientHeight-t.floatDrag.offsetHeight-t.distanceBottom),t.initDraggable()})),this.isScrollHidden&&window.addEventListener("scroll",this.handleScroll),window.addEventListener("resize",this.handleResize)},beforeDestroy:function(){this.id&&(window._DragBallComponent[this.id]={left:this.left,top:this.top}),window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize)},computed:{dragStyle:function(){return{left:this.left+"px",top:this.top+"px",zIndex:this.zIndex,position:"fixed"}},floatDrag:function(){return this.$refs.floatDrag}},methods:{handleScroll:function(){var t=this;this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){t.handleScrollEnd()}),200),this.currentTop=document.documentElement.scrollTop||document.body.scrollTop,this.left>this.clientWidth/2?this.left=this.clientWidth+this.floatDrag.offsetWidth:this.left=-this.floatDrag.offsetWidth},handleScrollEnd:function(){(document.documentElement.scrollTop||document.body.scrollTop)===this.currentTop&&(this.left>this.clientWidth/2?this.left=this.clientWidth-this.floatDrag.offsetWidth:this.left=0,clearTimeout(this.timer))},handleResize:function(){this.clientWidth=document.documentElement.clientWidth,this.clientHeight=document.documentElement.clientHeight,this.checkDraggablePosition()},initDraggable:function(){this.floatDrag.addEventListener("touchstart",this.toucheStart),this.floatDrag.addEventListener("touchmove",this.touchMove),this.floatDrag.addEventListener("touchend",this.touchEnd)},mouseDown:function(t){var e=this;this.record={time:(new Date).getTime(),top:this.floatDrag.offsetTop,left:this.floatDrag.offsetLeft,x:t.clientX-this.floatDrag.offsetLeft,y:t.clientY-this.floatDrag.offsetTop},this.floatDrag.style.transition="none",this.canClick=!1,document.onmousemove=function(t){var a=t.clientX-e.record.x,i=t.clientY-e.record.y;a<0?a=0:a>window.innerWidth-e.floatDrag.offsetWidth&&(a=window.innerWidth-e.floatDrag.offsetWidth),i<0?i=0:i>window.innerHeight-e.floatDrag.offsetHeight&&(i=window.innerHeight-e.floatDrag.offsetHeight),e.left=a,e.top=i},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,e.checkDraggablePosition(),e.floatDrag.style.transition="all 0.3s",(Math.abs(e.record.top-e.floatDrag.offsetTop)<5&&Math.abs(e.record.left-e.floatDrag.offsetLeft)<5||(new Date).getTime()-e.record.time<200)&&e.$emit("on-click")}},toucheStart:function(){this.canClick=!1,this.floatDrag.style.transition="none"},touchMove:function(t){if(this.canClick=!0,1===t.targetTouches.length){var e=event.targetTouches[0],a=e.clientX-this.floatDrag.offsetWidth/2,i=e.clientY-this.floatDrag.offsetHeight/2;a<0?a=0:a>window.innerWidth-this.floatDrag.offsetWidth&&(a=window.innerWidth-this.floatDrag.offsetWidth),i<0?i=0:i>window.innerHeight-this.floatDrag.offsetHeight&&(i=window.innerHeight-this.floatDrag.offsetHeight),this.left=a,this.top=i}},touchEnd:function(){this.canClick&&(this.floatDrag.style.transition="all 0.3s",this.checkDraggablePosition())},checkDraggablePosition:function(){this.left+this.floatDrag.offsetWidth/2>=this.clientWidth/2?this.left=this.clientWidth-this.floatDrag.offsetWidth:this.left=0,this.top<0&&(this.top=0),this.top+this.floatDrag.offsetHeight>=this.clientHeight&&(this.top=this.clientHeight-this.floatDrag.offsetHeight)}}};const D=(0,c.Z)(k,(function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{ref:"floatDrag",style:t.dragStyle,on:{mousedown:function(e){return e.stopPropagation(),e.preventDefault(),t.mouseDown.apply(null,arguments)}}},[t._t("default")],2)}),[],!1,null,null,null).exports;var $=a(41509);function C(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function L(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const T={name:"ReportEdit",components:{TEditor:function(){return Promise.resolve().then(a.bind(a,39208))},UserInput:a(47853).Z},props:{id:{default:0}},data:function(){return{reportData:{title:"",content:"",type:"weekly",receive:[],id:0,offset:0},disabledType:!1,prevCycleText:"",nextCycleText:""}},watch:{id:function(t){this.id>0?this.getDetail(t):(this.reportData.offset=0,this.reportData.type="weekly",this.reportData.receive=[],this.getTemplate())}},computed:function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?C(Object(a),!0).forEach((function(e){L(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):C(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},(0,i.rn)(["userId"])),mounted:function(){this.getTemplate()},methods:{initLanguage:function(){this.prevCycleText=this.$L("上一周"),this.nextCycleText=this.$L("下一周")},handleSubmit:function(){var t=this;if(0===this.reportData.receive.length)return $A.messageError(this.$L("请选择接收人")),!1;0===this.id&&this.reportData.id>1?$A.modalConfirm({title:"覆盖提交",content:"你已提交过此日期的报告，是否覆盖提交？",loading:!0,append:this.$el,onOk:function(){t.doSubmit()}}):this.doSubmit()},doSubmit:function(){var t=this;this.$store.dispatch("call",{url:"report/store",data:this.reportData,method:"post"}).then((function(e){e.data;var a=e.msg;t.reportData.offset=0,t.reportData.type="weekly",t.reportData.receive=[],t.getTemplate(),t.disabledType=!1,t.$Modal.remove(),$A.messageSuccess(a),t.$emit("saveSuccess")})).catch((function(e){var a=e.msg;t.$Modal.remove(),$A.messageError(a)}))},getTemplate:function(){var t=this;this.$store.dispatch("call",{url:"report/template",data:{type:this.reportData.type,offset:this.reportData.offset,id:this.id}}).then((function(e){var a=e.data;e.msg;a.id?(t.reportData.id=a.id,t.id>0?t.getDetail(a.id):(t.reportData.title=a.title,t.reportData.content=a.content)):(t.reportData.id=0,t.reportData.title=a.title,t.reportData.content=a.content)})).catch((function(t){var e=t.msg;$A.messageError(e)}))},typeChange:function(t){this.reportData.offset=0,"weekly"===t?(this.prevCycleText=this.$L("上一周"),this.nextCycleText=this.$L("下一周")):(this.prevCycleText=this.$L("上一天"),this.nextCycleText=this.$L("下一天")),this.getTemplate()},getDetail:function(t){var e=this;this.$store.dispatch("call",{url:"report/detail",data:{id:t}}).then((function(a){var i=a.data;a.msg;e.reportData.title=i.title,e.reportData.content=i.content,e.reportData.receive=i.receives_user.map((function(t){return t.userid})),e.reportData.type=i.type_val,e.reportData.id=t,e.disabledType=!0})).catch((function(t){var e=t.msg;$A.messageError(e)}))},prevCycle:function(){this.reportData.offset-=1,this.disabledType=!1,this.reReportData(),this.getTemplate()},nextCycle:function(){this.reportData.offset<0&&(this.reportData.offset+=1),this.disabledType=!1,this.reReportData(),this.getTemplate()},getLastSubmitter:function(){var t=this;this.$store.dispatch("call",{url:"report/last_submitter"}).then((function(e){var a=e.data;e.msg;t.reportData.receive=a})).catch((function(t){var e=t.msg;$A.messageError(e)}))},reReportData:function(){this.reportData.title="",this.reportData.content="",this.reportData.receive=[],this.reportData.id=0}}};const O=(0,c.Z)(T,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Form",{staticClass:"report-box",attrs:{"label-position":"top"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("Row",{staticClass:"report-row"},[a("Col",{attrs:{span:"2"}},[a("p",{staticClass:"report-titles"},[t._v(t._s(t.$L("汇报类型")))])]),t._v(" "),a("Col",{attrs:{span:"12"}},[a("RadioGroup",{staticClass:"report-radiogroup",attrs:{type:"button","button-style":"solid",readonly:t.id>0},on:{"on-change":t.typeChange},model:{value:t.reportData.type,callback:function(e){t.$set(t.reportData,"type",e)},expression:"reportData.type"}},[a("Radio",{attrs:{label:"weekly",disabled:t.id>0&&"daily"==t.reportData.type}},[t._v(t._s(t.$L("周报")))]),t._v(" "),a("Radio",{attrs:{label:"daily",disabled:t.id>0&&"weekly"==t.reportData.type}},[t._v(t._s(t.$L("日报")))])],1),t._v(" "),0===t.id?a("ButtonGroup",{staticClass:"report-buttongroup"},[a("ETooltip",{staticClass:"report-poptip",attrs:{content:t.prevCycleText,placement:"bottom"}},[a("Button",{attrs:{type:"primary"},on:{click:t.prevCycle}},[a("Icon",{attrs:{type:"ios-arrow-back"}})],1)],1),t._v(" "),a("div",{staticClass:"report-buttongroup-vertical"}),t._v(" "),a("ETooltip",{staticClass:"report-poptip",attrs:{disabled:t.reportData.offset>=0,content:t.nextCycleText,placement:"bottom"}},[a("Button",{attrs:{type:"primary",disabled:t.reportData.offset>=0},on:{click:t.nextCycle}},[a("Icon",{attrs:{type:"ios-arrow-forward"}})],1)],1)],1):t._e()],1)],1),t._v(" "),a("Row",{staticClass:"report-row"},[a("Col",{attrs:{span:"2"}},[a("p",{staticClass:"report-titles"},[t._v(t._s(t.$L("汇报名称")))])]),t._v(" "),a("Col",{attrs:{span:"22"}},[a("Input",{attrs:{disabled:""},model:{value:t.reportData.title,callback:function(e){t.$set(t.reportData,"title",e)},expression:"reportData.title"}})],1)],1),t._v(" "),a("Row",{staticClass:"report-row"},[a("Col",{attrs:{span:"2"}},[a("p",{staticClass:"report-titles"},[t._v(t._s(t.$L("汇报对象")))])]),t._v(" "),a("Col",{attrs:{span:"22"}},[a("div",{staticClass:"report-users"},[a("UserInput",{attrs:{disabledChoice:[t.userId],placeholder:t.$L("选择接收人"),transfer:!1},model:{value:t.reportData.receive,callback:function(e){t.$set(t.reportData,"receive",e)},expression:"reportData.receive"}}),t._v(" "),a("a",{staticClass:"report-row-a",attrs:{href:"javascript:void(0);"},on:{click:t.getLastSubmitter}},[a("Icon",{staticClass:"report-row-a-icon",attrs:{type:"ios-share-outline"}}),t._v(t._s(t.$L("使用我上次的汇报对象"))+"\n                ")],1)],1)])],1),t._v(" "),a("Row",{staticClass:"report-row report-row-content"},[a("Col",{attrs:{span:"2"}},[a("p",{staticClass:"report-titles"},[t._v(t._s(t.$L("汇报内容")))])]),t._v(" "),a("Col",{attrs:{span:"22"}},[a("FormItem",{staticClass:"report-row-content-editor"},[a("TEditor",{attrs:{height:"100%"},model:{value:t.reportData.content,callback:function(e){t.$set(t.reportData,"content",e)},expression:"reportData.content"}})],1)],1)],1),t._v(" "),a("Row",{staticClass:"report-row report-row-foot"},[a("Col",{attrs:{span:"2"}}),t._v(" "),a("Col",{attrs:{span:"4"}},[a("Button",{staticClass:"report-bottom",attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v(t._s(t.$L(t.id>0?"修改":"提交")))])],1)],1)],1)}),[],!1,null,"a551e170",null).exports;const j={name:"ReportMy",data:function(){return{loadIng:0,columns:[],lists:[],listPage:1,listTotal:0,listPageSize:10,noDataText:"",createAt:[],reportType:"",reportTypeList:[]}},mounted:function(){this.getLists()},methods:{initLanguage:function(){var t=this;this.noDataText=this.noDataText||"数据加载中.....",this.columns=[{title:this.$L("名称"),key:"title",sortable:!0,minWidth:120},{title:this.$L("类型"),key:"type",align:"center",sortable:!0,maxWidth:80},{title:this.$L("汇报时间"),key:"created_at",align:"center",sortable:!0,maxWidth:180},{title:this.$L("操作"),align:"center",width:100,minWidth:100,render:function(e,a){var i=a.column,s=a.row;if(!s.id)return null;var n=[e("ETooltip",{props:{content:t.$L("编辑"),transfer:!0,delay:600}},[e("Icon",{props:{type:"md-create",size:16},style:{margin:"0 3px",cursor:"pointer"},on:{click:function(){t.$emit("on-edit",s.id)}}})]),e("ETooltip",{props:{content:t.$L("查看"),transfer:!0,delay:600},style:{position:"relative",marginLeft:"6px"}},[e("Icon",{props:{type:"md-eye",size:16},style:{margin:"0 3px",cursor:"pointer"},on:{click:function(){t.$emit("on-view",s)}}})])];return e("TableAction",{props:{column:i}},n)}}],this.reportTypeList=[{value:"",label:this.$L("全部")},{value:"weekly",label:this.$L("周报")},{value:"daily",label:this.$L("日报")}]},getLists:function(){var t=this;this.loadIng=1,this.$store.dispatch("call",{url:"report/my",data:{page:this.listPage,pagesize:this.listPageSize,created_at:this.createAt,type:this.reportType}}).then((function(e){var a=e.data;e.msg;t.lists=a.data,t.listTotal=a.total,t.lists.length<=0&&(t.noDataText=t.$L("无数据"))})).catch((function(t){var e=t.msg;$A.messageError(e)})).finally((function(){t.loadIng=0}))},setPage:function(t){this.listPage=t,this.getLists()},setPageSize:function(t){Math.max($A.runNum(this.listPageSize),10)!==t&&(this.listPageSize=t,this.getLists())},searchTab:function(){this.getLists()},addReport:function(){this.$emit("on-edit",0)}}};const x=(0,c.Z)(j,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"report-list-wrap"},[a("div",{staticClass:"search-expand"},[a("div",{staticClass:"search-container lr"},[a("ul",[a("li",[a("div",{staticClass:"search-label"},[t._v("\n                        "+t._s(t.$L("汇报类型"))+"\n                    ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Select",{attrs:{placeholder:t.$L("全部")},model:{value:t.reportType,callback:function(e){t.reportType=e},expression:"reportType"}},t._l(t.reportTypeList,(function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1)]),t._v(" "),a("li",[a("div",{staticClass:"search-label"},[t._v("\n                        "+t._s(t.$L("汇报时间"))+"\n                    ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("DatePicker",{attrs:{type:"daterange","split-panels":"",placeholder:t.$L("请选择时间")},model:{value:t.createAt,callback:function(e){t.createAt=e},expression:"createAt"}})],1)]),t._v(" "),a("li",{staticClass:"search-button"},[a("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[a("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.searchTab}},[t._v(t._s(t.$L("搜索")))]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("刷新")))])],1)],1)],1)])]),t._v(" "),a("div",{staticClass:"expand-button-group"},[a("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:t.addReport}},[t._v(t._s(t.$L("新增报告")))])],1)]),t._v(" "),a("Table",{ref:"tableRef",staticClass:"tableFill report-row-content",attrs:{columns:t.columns,data:t.lists,loading:t.loadIng>0,"no-data-text":t.$L(t.noDataText),stripe:""}}),t._v(" "),a("Page",{staticClass:"page-box report-row-foot",attrs:{total:t.listTotal,current:t.listPage,disabled:t.loadIng>0,"page-size-opts":[10,20,30,50,100],placement:"top","show-elevator":"","show-sizer":"","show-total":"",transfer:""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)}),[],!1,null,"1d9ad226",null).exports;function P(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function S(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const I={name:"ReportReceive",data:function(){return{loadIng:0,columns:[],lists:[],listPage:1,listTotal:0,listPageSize:10,noDataText:"",username:"",reportType:"",createAt:[],reportTypeList:[]}},mounted:function(){this.getLists()},computed:function(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?P(Object(a),!0).forEach((function(e){S(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}({},(0,i.rn)(["userId"])),methods:{initLanguage:function(){var t=this;this.noDataText=this.noDataText||"数据加载中.....",this.columns=[{title:this.$L("标题"),key:"title",sortable:!0,minWidth:120,render:function(e,a){var i=a.row,s=[],n=i.receives_user.find((function(e){return e.userid==t.userId}));return n&&0==n.pivot.read?s.push(e("Tag",{props:{color:"orange"}},t.$L("未读")),e("span",i.title)):s.push(e("span",i.title)),e("div",s)}},{title:this.$L("类型"),key:"type",align:"center",sortable:!0,maxWidth:80},{title:this.$L("接收时间"),key:"receive_time",align:"center",sortable:!0,maxWidth:180},{title:this.$L("操作"),align:"center",width:100,minWidth:100,render:function(e,a){var i=a.column,s=a.row;if(!s.id)return null;var n=[e("ETooltip",{props:{content:t.$L("查看"),transfer:!0,delay:600},style:{position:"relative"}},[e("Icon",{props:{type:"md-eye",size:16},style:{margin:"0 3px",cursor:"pointer"},on:{click:function(){t.$emit("on-view",s);var e=s.receives_user.find((function(e){return e.userid==t.userId}));e&&t.$set(e.pivot,"read",1)}}})])];return e("TableAction",{props:{column:i}},n)}}],this.reportTypeList=[{value:"",label:this.$L("全部")},{value:"weekly",label:this.$L("周报")},{value:"daily",label:this.$L("日报")}]},getLists:function(){var t=this;this.loadIng=1,this.$store.dispatch("call",{url:"report/receive",data:{page:this.listPage,pagesize:this.listPageSize,username:this.username,created_at:this.createAt,type:this.reportType}}).then((function(e){var a=e.data;e.msg;t.lists=a.data,t.listTotal=a.total,t.lists.length<=0&&(t.noDataText=t.$L("无数据"))})).catch((function(t){var e=t.msg;$A.messageError(e)})).finally((function(){t.loadIng=0}))},setPage:function(t){this.listPage=t,this.getLists()},setPageSize:function(t){Math.max($A.runNum(this.listPageSize),10)!==t&&(this.listPageSize=t,this.getLists())},searchTab:function(){this.getLists()}}};const A=(0,c.Z)(I,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"report-list-wrap"},[a("div",{staticClass:"search-container lr"},[a("ul",[a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("汇报人"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Input",{attrs:{placeholder:t.$L("请输入用户名")},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1)]),t._v(" "),a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("汇报类型"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("Select",{attrs:{placeholder:t.$L("全部")},model:{value:t.reportType,callback:function(e){t.reportType=e},expression:"reportType"}},t._l(t.reportTypeList,(function(e){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1)]),t._v(" "),a("li",[a("div",{staticClass:"search-label"},[t._v("\n                    "+t._s(t.$L("汇报时间"))+"\n                ")]),t._v(" "),a("div",{staticClass:"search-content"},[a("DatePicker",{attrs:{type:"daterange","split-panels":"",placeholder:t.$L("请选择时间")},model:{value:t.createAt,callback:function(e){t.createAt=e},expression:"createAt"}})],1)]),t._v(" "),a("li",{staticClass:"search-button"},[a("Tooltip",{attrs:{theme:"light",placement:"right","transfer-class-name":"search-button-clear",transfer:""}},[a("Button",{attrs:{loading:t.loadIng>0,type:"primary",icon:"ios-search"},on:{click:t.searchTab}},[t._v(t._s(t.$L("搜索")))]),t._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("Button",{attrs:{loading:t.loadIng>0,type:"text"},on:{click:t.getLists}},[t._v(t._s(t.$L("刷新")))])],1)],1)],1)])]),t._v(" "),a("Table",{ref:"tableRef",staticClass:"tableFill report-row-content",attrs:{columns:t.columns,data:t.lists,loading:t.loadIng>0,"no-data-text":t.$L(t.noDataText),stripe:""}}),t._v(" "),a("Page",{staticClass:"page-box report-row-foot",attrs:{total:t.listTotal,current:t.listPage,disabled:t.loadIng>0,"page-size-opts":[10,20,30,50,100],placement:"top","show-elevator":"","show-sizer":"","show-total":"",transfer:""},on:{"on-change":t.setPage,"on-page-size-change":t.setPageSize}})],1)}),[],!1,null,"8f6b5f4c",null).exports;const z={name:"ReportDetail",props:{data:{default:{}}},mounted:function(){this.data.id>0&&this.sendRead()},watch:{data:function(){this.data.id>0&&this.sendRead()}},methods:{sendRead:function(){this.$store.dispatch("call",{url:"report/read",data:{ids:[this.data.id]}}).then((function(t){t.data,t.msg})).catch((function(t){t.msg}))}}};const E=(0,c.Z)(z,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"report-detail"},[a("div",{staticClass:"report-title"},[t._v(t._s(t.data.title))]),t._v(" "),a("div",{staticClass:"report-detail-context"},[a("div",{staticClass:"report-profile"},[a("Row",[a("Col",{attrs:{span:"2"}},[a("div",{staticClass:"report-submitter"},[a("p",[t._v(t._s(t.$L("汇报人")))])])]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("div",{staticClass:"report-submitter"},[a("UserAvatar",{attrs:{userid:t.data.userid,size:28}})],1)]),t._v(" "),a("Col",{attrs:{span:"2"}},[a("div",{staticClass:"report-submitter"},[a("p",[t._v(t._s(t.$L("提交时间")))])])]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("div",{staticClass:"report-submitter"},[a("div",[t._v(t._s(t.data.created_at))])])]),t._v(" "),a("Col",{attrs:{span:"2"}},[a("div",{staticClass:"report-submitter"},[a("p",[t._v(t._s(t.$L("汇报对象")))])])]),t._v(" "),a("Col",{attrs:{span:"6"}},[a("div",{staticClass:"report-submitter"},t._l(t.data.receives_user,(function(t,e){return a("UserAvatar",{key:e,attrs:{userid:t.userid,size:28}})})),1)])],1)],1),t._v(" "),a("Row",{staticClass:"report-main"},[a("Col",{attrs:{span:"2"}},[a("div",{staticClass:"report-submitter"},[a("p",[t._v(t._s(t.$L("汇报内容")))])])]),t._v(" "),a("Col",{attrs:{span:"22"}},[a("div",{staticClass:"report-content",domProps:{innerHTML:t._s(t.data.content)}})])],1)],1)])}),[],!1,null,"50c4f848",null).exports,R={name:"Report",components:{DrawerOverlay:w.Z,ReportEdit:O,ReportMy:x,ReportReceive:A,ReportDetail:E},props:{reportUnreadNumber:{type:Number,default:0},reportType:{default:"my"}},data:function(){return{reportTabs:"my",showDetailDrawer:!1,showEditDrawer:!1,detailData:{},reportId:0}},mounted:function(){this.reportTabs=this.reportType},methods:{tabRebder:function(t){var e=this;return function(a){return a("div",t>0?[a("span",{class:"navbar-item-content"},e.$L("收到的汇报")),a("Badge",{class:"manage-box-report",props:{count:t}})]:[a("span",{class:"navbar-item-content"},e.$L("收到的汇报"))])}},onView:function(t){this.showDetailDrawer=!0,this.detailData=t,this.$emit("on-read")},onEditReport:function(t){this.reportId=t,this.showEditDrawer=!0},saveSuccess:function(){this.reportId=0,this.reportTabs="my",this.showEditDrawer=!1,this.$refs.report&&this.$refs.report.getLists()}}};const M=(0,c.Z)(R,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"report"},[a("Tabs",{model:{value:t.reportTabs,callback:function(e){t.reportTabs=e},expression:"reportTabs"}},[a("TabPane",{attrs:{label:t.$L("我的汇报"),name:"my"}},["my"===t.reportTabs?a("ReportMy",{ref:"report",on:{"on-view":t.onView,"on-edit":t.onEditReport}}):t._e()],1),t._v(" "),a("TabPane",{attrs:{label:t.tabRebder(t.reportUnreadNumber),name:"receive"}},["receive"===t.reportTabs?a("ReportReceive",{on:{"on-view":t.onView}}):t._e()],1)],1),t._v(" "),a("DrawerOverlay",{attrs:{placement:"right",size:950,transfer:""},model:{value:t.showDetailDrawer,callback:function(e){t.showDetailDrawer=e},expression:"showDetailDrawer"}},[a("ReportDetail",{attrs:{data:t.detailData}})],1),t._v(" "),a("DrawerOverlay",{attrs:{placement:"right",size:1e3,transfer:""},model:{value:t.showEditDrawer,callback:function(e){t.showEditDrawer=e},expression:"showEditDrawer"}},[a("ReportEdit",{attrs:{id:t.reportId},on:{saveSuccess:t.saveSuccess}})],1)],1)}),[],!1,null,"4cc721de",null).exports;var N=a(80641);a(33301);function B(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function W(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?B(Object(a),!0).forEach((function(e){U(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):B(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function U(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const H={components:{TaskAdd:$.Z,Report:M,DragBallComponent:D,DrawerOverlay:w.Z,ProjectManagement:_,TeamManagement:v,ProjectArchived:l,TaskDetail:s.Z},data:function(){return{loadIng:0,curPath:this.$route.path,mateName:/macintosh|mac os x/i.test(navigator.userAgent)?"⌘":"Ctrl",addShow:!1,addData:{name:"",columns:"",flow:"open"},addRule:{},addTaskShow:!1,addTaskSubscribe:null,dialogMsgSubscribe:null,projectKeyValue:"",projectKeyAlready:{},projectKeyLoading:0,openMenu:{},visibleMenu:!1,show768Menu:!1,innerHeight:window.innerHeight,workReportShow:!1,allUserShow:!1,allProjectShow:!1,archivedProjectShow:!1,natificationHidden:!1,natificationReady:!1,notificationClass:null,reportTabs:"my",reportUnreadNumber:0,topOperateStyles:{},topOperateVisible:!1,topOperateItem:{}}},mounted:function(){$A.getStorageString("clearCache")&&($A.setStorage("clearCache",""),$A.messageSuccess("清除成功")),this.$store.dispatch("getUserInfo").catch((function(){})),this.$store.dispatch("getTaskPriority").catch((function(){})),this.getReportUnread(0),this.notificationInit(),this.onVisibilityChange(),this.addTaskSubscribe=N.Store.subscribe("addTask",this.onAddTask),this.dialogMsgSubscribe=N.Store.subscribe("dialogMsgPush",this.addDialogMsg),document.addEventListener("keydown",this.shortcutEvent),window.addEventListener("resize",this.innerHeightListener)},beforeDestroy:function(){this.addTaskSubscribe&&(this.addTaskSubscribe.unsubscribe(),this.addTaskSubscribe=null),this.dialogMsgSubscribe&&(this.dialogMsgSubscribe.unsubscribe(),this.dialogMsgSubscribe=null),document.removeEventListener("keydown",this.shortcutEvent),window.removeEventListener("resize",this.innerHeightListener)},deactivated:function(){this.addShow=!1},computed:W(W(W({},(0,i.rn)(["userId","userInfo","userIsAdmin","cacheDialogs","cacheProjects","projectTotal","taskId","wsOpenNum","columnTemplate","dialogOpenId","themeMode","themeList","wsMsg"])),(0,i.Se)(["taskData","dashboardTask"])),{},{msgAllUnread:function(){var t=0;return this.cacheDialogs.some((function(e){var a=e.unread;a&&(t+=a)})),t},dashboardTotal:function(){return this.dashboardTask.today.length+this.dashboardTask.overdue.length},unreadTotal:function(){return this.msgAllUnread+this.dashboardTotal+this.reportUnreadNumber},currentLanguage:function(){return this.languageList[this.languageType]||"Language"},menu:function(){return this.userIsAdmin?[{path:"personal",name:"个人设置"},{path:"password",name:"密码设置"},{path:"clearCache",name:"清除缓存"},{path:"system",name:"系统设置",divided:!0},{path:"workReport",name:"工作报告",divided:!0},{path:"allUser",name:"团队管理"},{path:"allProject",name:"所有项目"},{path:"archivedProject",name:"已归档的项目"}]:[{path:"personal",name:"个人设置"},{path:"password",name:"密码设置"},{path:"clearCache",name:"清除缓存"},{path:"workReport",name:"工作报告",divided:!0},{path:"archivedProject",name:"已归档的项目"}]},columns:function(){var t=$A.cloneJSON(this.columnTemplate);return t.unshift({name:this.$L("空白模板"),columns:[]}),t},projectLists:function(){var t=this.projectKeyValue,e=this.cacheProjects.sort((function(t,e){return t.top_at||e.top_at?$A.Date(e.top_at)-$A.Date(t.top_at):e.id-t.id}));return t?e.filter((function(e){return e.name.toLowerCase().indexOf(t.toLowerCase())>-1})):e},taskStyle:function(){var t=this.innerHeight;return{maxHeight:t-(t>900?200:70)-20+"px"}}}),watch:{$route:function(t){this.curPath=t.path,this.chackPass()},userInfo:function(){this.chackPass()},taskId:function(t){t>0&&this.$Modal.resetIndex()},projectKeyValue:function(t){var e=this;""!=t&&setTimeout((function(){e.projectKeyValue==t&&e.searchProject()}),600)},natificationHidden:function(t){var e=this;clearTimeout(this.notificationTimeout),!t&&this.notificationClass&&(this.notificationTimeout=setTimeout((function(){e.notificationClass.close()}),6e3))},wsOpenNum:function(t){var e=this;t<=1||(this.wsOpenTimeout&&clearTimeout(this.wsOpenTimeout),this.wsOpenTimeout=setTimeout((function(){e.$store.dispatch("getBasicData"),e.getReportUnread()}),5e3))},workReportShow:function(t){t&&this.getReportUnread(0)},unreadTotal:{handler:function(t){this.$Electron&&this.$Electron.ipcRenderer.send("setDockBadge",t)},immediate:!0},wsMsg:{handler:function(t){var e=t.type,a=t.action;if("report"===e)"unreadUpdate"==a&&this.getReportUnread()},deep:!0}},methods:{initLanguage:function(){this.addRule={name:[{required:!0,message:this.$L("请填写项目名称！"),trigger:"change"},{type:"string",min:2,message:this.$L("项目名称至少2个字！"),trigger:"change"}]}},innerHeightListener:function(){this.innerHeight=window.innerHeight},chackPass:function(){1===this.userInfo.changepass&&this.goForward({path:"/manage/setting/password"})},setTheme:function(t){this.$store.dispatch("setTheme",t)},toggleRoute:function(t){this.show768Menu=!1,this.goForward({path:"/manage/"+t})},toggleOpenMenu:function(t){this.$set(this.openMenu,t,!this.openMenu[t])},settingRoute:function(t){var e=this;switch(t){case"allUser":return void(this.allUserShow=!0);case"allProject":return void(this.allProjectShow=!0);case"archivedProject":return void(this.archivedProjectShow=!0);case"workReport":return this.reportUnreadNumber>0&&(this.reportTabs="receive"),void(this.workReportShow=!0);case"clearCache":return void this.$store.dispatch("handleClearCache",null).then((function(){$A.setStorage("clearCache",$A.randomString(6)),window.location.reload()})).catch((function(){window.location.reload()}));case"signout":return void $A.modalConfirm({title:"退出登录",content:"你确定要登出系统？",onOk:function(){e.$store.dispatch("logout",!1)}})}this.menu.findIndex((function(e){return e.path==t}))>-1&&this.toggleRoute("setting/"+t)},menuVisibleChange:function(t){this.visibleMenu=t},classNameRoute:function(t,e){return{active:this.curPath=="/manage/"+t,"open-menu":!0===e}},onAddShow:function(){var t=this;this.$store.dispatch("getColumnTemplate").catch((function(){})),this.addShow=!0,this.$nextTick((function(){t.$refs.projectName.focus()}))},onAddProject:function(){var t=this;this.$refs.addProject.validate((function(e){e&&(t.loadIng++,t.$store.dispatch("call",{url:"project/add",data:t.addData}).then((function(e){var a=e.data,i=e.msg;$A.messageSuccess(i),t.loadIng--,t.addShow=!1,t.$refs.addProject.resetFields(),t.$store.dispatch("saveProject",a),t.toggleRoute("project/"+a.id)})).catch((function(e){var a=e.msg;$A.modalError(a),t.loadIng--})))}))},searchProject:function(){var t=this;!0!==this.projectKeyAlready[this.projectKeyValue]&&(this.projectKeyAlready[this.projectKeyValue]=!0,setTimeout((function(){t.projectKeyLoading++}),1e3),this.$store.dispatch("getProjects",{keys:{name:this.projectKeyValue}}).then((function(){t.projectKeyLoading--})).catch((function(){t.projectKeyLoading--})))},selectChange:function(t){var e=this;this.$nextTick((function(){e.$set(e.addData,"columns",e.columns[t].columns.join(","))}))},shortcutEvent:function(t){75!==t.keyCode&&78!==t.keyCode||(t.metaKey||t.ctrlKey)&&(t.preventDefault(),this.onAddTask(0))},onAddTask:function(t){this.$refs.addTask.defaultPriority(),this.$refs.addTask.setData($A.isJson(t)?t:{owner:this.userId,column_id:t}),this.addTaskShow=!0},addDialogMsg:function(t){var e=this;if(this.natificationReady&&(this.natificationHidden||"/manage/messenger"!=this.curPath||this.dialogOpenId!=t.dialog_id)){var a=t.id,i=t.dialog_id,s=t.type,n=t.msg,o="";switch(s){case"text":o=n.text;break;case"file":o="["+this.$L("img"==n.type?"图片信息":"文件信息")+"]";break;default:return}this._notificationId=a,this.notificationClass.replaceOptions({icon:$A.originUrl("images/logo.png"),body:o,data:t,tag:"dialog",requireInteraction:!0});var r=this.cacheDialogs.find((function(t){return t.id==i}));r?(this.notificationClass.replaceTitle(r.name),this.notificationClass.userAgreed()):this.$store.dispatch("getDialogOne",i).then((function(t){var i=t.data;e._notificationId===a&&(e.notificationClass.replaceTitle(i.name),e.notificationClass.userAgreed())})).catch((function(){}))}},taskVisibleChange:function(t){t||this.$store.dispatch("openTask",0)},getReportUnread:function(t){var e=this;this.reportUnreadTimeout&&clearTimeout(this.reportUnreadTimeout),this.reportUnreadTimeout=setTimeout((function(){e.$store.dispatch("call",{url:"report/unread"}).then((function(t){var a=t.data;e.reportUnreadNumber=a.total?a.total:0})).catch((function(){}))}),"number"==typeof t?t:1e3)},notificationInit:function(){var t=this;this.notificationClass=new p(this.$L("打开通知成功")),this.notificationClass.support&&(this.notificationClass.notificationEvent({onclick:function(e){var a=e.target;console.log("[Notification] Click",a),t.notificationClass.close(),window.focus();var i=a.tag,s=a.data;if("dialog"==i){if(!$A.isJson(s))return;t.goForward({path:"/manage/messenger"}),s.dialog_id&&($A.setStorage("messenger::dialogId",s.dialog_id),t.$store.state.dialogOpenId=s.dialog_id)}}}),this.notificationPermission())},notificationPermission:function(){var t=this;this.notificationClass.initNotification((function e(a){switch(a){case"already granted":case"granted":return t.natificationReady=!0;case"close":return t.notificationClass.initNotification(e);case"denied":case"already denied":"denied"===a?console.log("您刚刚拒绝显示通知 请在设置中更改设置"):console.log("您曾级拒绝显示通知 请在设置中更改设置")}}))},onVisibilityChange:function(){var t=this,e="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null,a=e.replace(/hidden/i,"visibilitychange");document.addEventListener(a,(function(){t.natificationHidden=!!document[e]}))},handleRightClick:function(t,e){var a=this;this.handleClickTopOperateOutside(),this.topOperateItem=$A.isJson(e)?e:{},this.$nextTick((function(){var e=a.$refs.projectWrapper.getBoundingClientRect();a.topOperateStyles={left:"".concat(t.clientX-e.left,"px"),top:"".concat(t.clientY-e.top,"px")},a.topOperateVisible=!0}))},handleClickTopOperateOutside:function(){this.topOperateVisible=!1},handleTopClick:function(){var t=this;this.$store.dispatch("call",{url:"project/top",data:{project_id:this.topOperateItem.id}}).then((function(){t.$store.dispatch("getProjects").catch((function(){})),t.$Modal.remove()})).catch((function(e){var a=e.msg;$A.modalError(a,301),t.$Modal.remove()}))},listScroll:function(){this.topOperateVisible=!1}}};const V=(0,c.Z)(H,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"show",rawName:"v-show",value:t.userId>0,expression:"userId > 0"}],staticClass:"page-manage"},[a("div",{staticClass:"manage-box-menu",class:{"show768-menu":t.show768Menu}},[a("Dropdown",{staticClass:"manage-box-dropdown",attrs:{trigger:"click"},on:{"on-click":t.settingRoute,"on-visible-change":t.menuVisibleChange}},[a("div",{class:["manage-box-title",t.visibleMenu?"menu-visible":""]},[a("div",{staticClass:"manage-box-avatar"},[a("UserAvatar",{attrs:{userid:t.userId,size:36,tooltipDisabled:""}})],1),t._v(" "),a("span",[t._v(t._s(t.userInfo.nickname))]),t._v(" "),a("Badge",{staticClass:"manage-box-top-report",attrs:{count:t.reportUnreadNumber}}),t._v(" "),a("div",{staticClass:"manage-box-arrow"},[a("Icon",{attrs:{type:"ios-arrow-up"}}),t._v(" "),a("Icon",{attrs:{type:"ios-arrow-down"}})],1)],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[t._l(t.menu,(function(e,i){return a("DropdownItem",{key:i,attrs:{divided:!!e.divided,name:e.path}},[t._v("\n                    "+t._s(t.$L(e.name))+"\n                    "),"workReport"===e.path?a("Badge",{staticClass:"manage-menu-report-badge",attrs:{count:t.reportUnreadNumber}}):t._e()],1)})),t._v(" "),a("Dropdown",{attrs:{placement:"right-start"},on:{"on-click":t.setTheme}},[a("DropdownItem",{attrs:{divided:""}},[a("div",{staticClass:"manage-menu-language"},[t._v("\n                            "+t._s(t.$L("主题皮肤"))+"\n                            "),a("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.themeList,(function(e,i){return a("Dropdown-item",{key:i,attrs:{name:e.value,selected:t.themeMode===e.value}},[t._v(t._s(t.$L(e.name)))])})),1)],1),t._v(" "),a("Dropdown",{attrs:{placement:"right-start"},on:{"on-click":t.setLanguage}},[a("DropdownItem",{attrs:{divided:""}},[a("div",{staticClass:"manage-menu-language"},[t._v("\n                            "+t._s(t.currentLanguage)+"\n                            "),a("Icon",{attrs:{type:"ios-arrow-forward"}})],1)]),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},t._l(t.languageList,(function(e,i){return a("Dropdown-item",{key:i,attrs:{name:i,selected:t.getLanguage()===i}},[t._v(t._s(e))])})),1)],1),t._v(" "),a("DropdownItem",{staticStyle:{color:"#f40"},attrs:{divided:"",name:"signout"}},[t._v(t._s(t.$L("退出登录")))])],2)],1),t._v(" "),a("ul",{staticClass:"overlay-y",on:{scroll:function(e){return t.listScroll()}}},[a("li",{class:t.classNameRoute("dashboard"),on:{click:function(e){return t.toggleRoute("dashboard")}}},[a("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),a("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("仪表盘")))]),t._v(" "),a("Badge",{staticClass:"menu-badge",attrs:{type:t.dashboardTask.overdue.length>0?"error":"primary",count:t.dashboardTotal}})],1),t._v(" "),a("li",{class:t.classNameRoute("calendar"),on:{click:function(e){return t.toggleRoute("calendar")}}},[a("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),a("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("日历")))])]),t._v(" "),a("li",{class:t.classNameRoute("messenger"),on:{click:function(e){return t.toggleRoute("messenger")}}},[a("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),a("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("消息")))]),t._v(" "),a("Badge",{staticClass:"menu-badge",attrs:{count:t.msgAllUnread}})],1),t._v(" "),a("li",{class:t.classNameRoute("file"),on:{click:function(e){return t.toggleRoute("file")}}},[a("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),a("div",{staticClass:"menu-title"},[t._v(t._s(t.$L("文件")))])]),t._v(" "),a("li",{ref:"projectWrapper",staticClass:"menu-project"},[a("ul",t._l(t.projectLists,(function(e,i){return a("li",{key:i,class:t.classNameRoute("project/"+e.id,t.openMenu[e.id]),on:{click:function(a){return t.toggleRoute("project/"+e.id)},contextmenu:function(a){return a.preventDefault(),a.stopPropagation(),t.handleRightClick(a,e)}}},[a("div",{class:{top:e.top_at,operate:e.id==t.topOperateItem.id&&t.topOperateVisible}},[a("div",{staticClass:"project-h1"},[a("em",{on:{click:function(a){return a.stopPropagation(),t.toggleOpenMenu(e.id)}}}),t._v(" "),a("div",{staticClass:"title"},[t._v(t._s(e.name))]),t._v(" "),e.task_my_num-e.task_my_complete>0?a("div",{staticClass:"num"},[t._v(t._s(e.task_my_num-e.task_my_complete))]):t._e()]),t._v(" "),a("div",{staticClass:"project-h2"},[a("p",[a("em",[t._v(t._s(t.$L("我的"))+":")]),t._v(" "),a("span",[t._v(t._s(e.task_my_complete)+"/"+t._s(e.task_my_num))]),t._v(" "),a("Progress",{attrs:{percent:e.task_my_percent,"stroke-width":6}})],1),t._v(" "),a("p",[a("em",[t._v(t._s(t.$L("全部"))+":")]),t._v(" "),a("span",[t._v(t._s(e.task_complete)+"/"+t._s(e.task_num))]),t._v(" "),a("Progress",{attrs:{percent:e.task_percent,"stroke-width":6}})],1)])])])})),0),t._v(" "),t.loadIng>0?a("Loading"):t._e(),t._v(" "),a("div",{staticClass:"top-operate",style:t.topOperateStyles},[a("Dropdown",{attrs:{trigger:"custom",visible:t.topOperateVisible,"transfer-class-name":"page-file-dropdown-menu",transfer:""},on:{"on-clickoutside":t.handleClickTopOperateOutside}},[a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{nativeOn:{click:function(e){return t.handleTopClick.apply(null,arguments)}}},[t._v("\n                                "+t._s(t.$L(t.topOperateItem.top_at?"取消置顶":"置顶该项目"))+"\n                            ")])],1)],1)],1)],1)]),t._v(" "),t.projectTotal>50?a("div",{staticClass:"manage-project-search",class:{loading:t.projectKeyLoading>0}},[a("Input",{attrs:{prefix:"ios-search",placeholder:t.$L("共"+t.projectTotal+"个项目，搜索..."),clearable:""},model:{value:t.projectKeyValue,callback:function(e){t.projectKeyValue=e},expression:"projectKeyValue"}})],1):t._e(),t._v(" "),a("ButtonGroup",{staticClass:"manage-box-new-group"},[a("Button",{staticClass:"manage-box-new",attrs:{type:"primary",icon:"md-add"},on:{click:t.onAddShow}},[t._v(t._s(t.$L("新建项目")))]),t._v(" "),a("Dropdown",{on:{"on-click":function(e){return t.onAddTask(0)}}},[a("Button",{attrs:{type:"primary"}},[a("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",[t._v(t._s(t.$L("新建任务"))+" ("+t._s(t.mateName)+"+K)")])],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"manage-box-main"},[a("keep-alive",[a("router-view",{staticClass:"manage-box-view overlay"})],1)],1),t._v(" "),a("Modal",{attrs:{title:t.$L("新建项目"),"mask-closable":!1},model:{value:t.addShow,callback:function(e){t.addShow=e},expression:"addShow"}},[a("Form",{ref:"addProject",attrs:{model:t.addData,rules:t.addRule,"label-width":"auto"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("FormItem",{attrs:{prop:"name",label:t.$L("项目名称")}},[a("Input",{ref:"projectName",attrs:{type:"text"},model:{value:t.addData.name,callback:function(e){t.$set(t.addData,"name",e)},expression:"addData.name"}})],1),t._v(" "),t.addData.columns?a("FormItem",{attrs:{label:t.$L("任务列表")}},[a("TagInput",{model:{value:t.addData.columns,callback:function(e){t.$set(t.addData,"columns",e)},expression:"addData.columns"}})],1):a("FormItem",{attrs:{label:t.$L("项目模板")}},[a("Select",{attrs:{value:0,placeholder:t.$L("请选择模板")},on:{"on-change":t.selectChange}},t._l(t.columns,(function(e,i){return a("Option",{key:i,attrs:{value:i}},[t._v(t._s(e.name))])})),1)],1),t._v(" "),a("FormItem",{attrs:{prop:"flow",label:t.$L("开启工作流")}},[a("RadioGroup",{model:{value:t.addData.flow,callback:function(e){t.$set(t.addData,"flow",e)},expression:"addData.flow"}},[a("Radio",{attrs:{label:"open"}},[t._v(t._s(t.$L("开启")))]),t._v(" "),a("Radio",{attrs:{label:"close"}},[t._v(t._s(t.$L("关闭")))])],1)],1)],1),t._v(" "),a("div",{staticClass:"adaption",attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"default"},on:{click:function(e){t.addShow=!1}}},[t._v(t._s(t.$L("取消")))]),t._v(" "),a("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onAddProject}},[t._v(t._s(t.$L("添加")))])],1)],1),t._v(" "),a("Modal",{attrs:{"mask-closable":!1,styles:{width:"90%",maxWidth:"640px"},"footer-hide":""},model:{value:t.addTaskShow,callback:function(e){t.addTaskShow=e},expression:"addTaskShow"}},[a("TaskAdd",{ref:"addTask",model:{value:t.addTaskShow,callback:function(e){t.addTaskShow=e},expression:"addTaskShow"}})],1),t._v(" "),a("Modal",{attrs:{value:t.taskId>0,"mask-closable":!1,styles:{width:"90%",maxWidth:t.taskData.dialog_id?"1200px":"700px"},"footer-hide":""},on:{"on-visible-change":t.taskVisibleChange}},[a("div",{staticClass:"page-manage-task-modal",style:t.taskStyle},[a("TaskDetail",{attrs:{"task-id":t.taskId,"open-task":t.taskData}})],1)]),t._v(" "),a("DrawerOverlay",{attrs:{placement:"right",size:1100},model:{value:t.workReportShow,callback:function(e){t.workReportShow=e},expression:"workReportShow"}},[t.workReportShow?a("Report",{attrs:{reportType:t.reportTabs,reportUnreadNumber:t.reportUnreadNumber},on:{"on-read":t.getReportUnread}}):t._e()],1),t._v(" "),a("DrawerOverlay",{attrs:{placement:"right",size:1100},model:{value:t.allUserShow,callback:function(e){t.allUserShow=e},expression:"allUserShow"}},[t.allUserShow?a("TeamManagement"):t._e()],1),t._v(" "),a("DrawerOverlay",{attrs:{placement:"right",size:1100},model:{value:t.allProjectShow,callback:function(e){t.allProjectShow=e},expression:"allProjectShow"}},[t.allProjectShow?a("ProjectManagement"):t._e()],1),t._v(" "),a("DrawerOverlay",{attrs:{placement:"right",size:1100},model:{value:t.archivedProjectShow,callback:function(e){t.archivedProjectShow=e},expression:"archivedProjectShow"}},[t.archivedProjectShow?a("ProjectArchived"):t._e()],1),t._v(" "),a("DragBallComponent",{attrs:{distanceLeft:0,distanceTop:60},on:{"on-click":function(e){t.show768Menu=!t.show768Menu}}},[a("div",{staticClass:"manage-mini-menu"},[a("Icon",{attrs:{type:t.show768Menu?"md-close":"md-menu"}}),t._v(" "),a("Badge",{attrs:{count:t.unreadTotal}})],1)])],1)}),[],!1,null,null,null).exports},41509:(t,e,a)=>{a.d(e,{Z:()=>l});var i=a(39208),s=a(20629);function n(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?n(Object(a),!0).forEach((function(e){r(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function r(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const c={name:"TaskAdd",components:{UserInput:a(47853).Z,TEditor:i.default},props:{value:{type:Boolean,default:!1}},data:function(){return{ready:!1,addData:{cascader:[],name:"",content:"",owner:0,add_assist:1,project_id:0,column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:""},cascaderShow:!1,cascaderData:[],cascaderValue:"",cascaderLoading:0,cascaderAlready:[],advanced:!1,subName:"",taskPlugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace visualblocks visualchars code","insertdatetime media nonbreaking save table directionality","emoticons paste codesample","autoresize"],taskOptions:{statusbar:!1,menubar:!1,autoresize_bottom_margin:2,min_height:200,max_height:380,contextmenu:"bold italic underline forecolor backcolor | codesample | uploadImages browseImages | preview screenload",valid_elements:"a[href|target=_blank],em,strong/b,div[align],span[style],a,br,p,img[src|alt|witdh|height],pre[class],code",toolbar:!1},taskOptionFull:{menubar:"file edit view",valid_elements:"a[href|target=_blank],em,strong/b,div[align],span[style],a,br,p,img[src|alt|witdh|height],pre[class],code",toolbar:"uploadImages | bold italic underline forecolor backcolor | codesample | preview screenload"},taskTimeOpen:!1,timeOptions:{shortcuts:$A.timeOptionShortcuts()},loadIng:0,beforeClose:[]}},mounted:function(){},computed:o(o({},(0,s.rn)(["isDesktop","userId","cacheProjects","projectId","cacheColumns","taskPriority"])),{},{taskDays:function(){var t=this.addData.times,e=$A.date2string(t,"Y-m-d H:i");if(e[0]&&e[1]){var a=Math.ceil(($A.Date(e[1]).getTime()-$A.Date(e[0]).getTime())/864e5);if(a>0)return a}return 0},showAddAssist:function(){var t=this.addData.owner;return(!$A.isArray(t)||!t.includes(this.userId))&&t!=this.userId}}),watch:{value:function(t){var e=this;t?(this.ready=!0,this.initCascaderData(),this.initProjectData(),this.$nextTick((function(){e.$refs.input.focus()}))):(this.beforeClose.some((function(t){"function"==typeof t&&t()})),this.beforeClose=[],this.taskTimeOpen=!1)},"addData.project_id":function(t){t>0&&$A.setStorage("cacheAddTaskProjectId",t)},"addData.column_id":function(t){var e=this,a=this.addData.project_id;this.$nextTick((function(){a&&t?e.$set(e.addData,"cascader",[a,t]):e.$set(e.addData,"cascader",[])})),t>0&&$A.setStorage("cacheAddTaskColumnId",t)}},methods:{initLanguage:function(){},initCascaderData:function(){var t=this;this.cascaderData=this.cacheProjects.map((function(e){var a=t.cacheColumns.filter((function(t){return t.project_id==e.id})).map((function(t){return{value:t.id,label:t.name}})),i={value:e.id,label:e.name,children:a};return 0==a.length&&(i.loading=!1),i}))},initProjectData:function(){var t=this,e=this.addData.column_id;if(e){var a=this.cacheColumns.find((function(t){return t.id==e}));a&&(this.addData.project_id=a.project_id,this.addData.column_id=a.id)}else{var i=$A.getStorageInt("cacheAddTaskProjectId"),s=$A.getStorageInt("cacheAddTaskColumnId"),n=this.cacheProjects.find((function(e){return e.id==t.projectId}))||this.cacheProjects.find((function(t){return t.id==i}))||this.cacheProjects.find((function(t){return t.id>0}));if(n){var o=this.cacheColumns.find((function(t){var e=t.project_id,a=t.id;return e==n.id&&a==s}))||this.cacheColumns.find((function(t){return t.project_id==n.id}));o?(this.addData.project_id=o.project_id,this.addData.column_id=o.id):this.$store.dispatch("getColumns",n.id).then((function(){(o=t.cacheColumns.find((function(t){var e=t.project_id,a=t.id;return e==n.id&&a==s}))||t.cacheColumns.find((function(t){return t.project_id==n.id})))&&(t.addData.project_id=o.project_id,t.addData.column_id=o.id)})).catch((function(){}))}}},taskTimeOpenChange:function(t){this.taskTimeOpen=t},taskTimeChange:function(t){var e=$A.date2string(t,"Y-m-d H:i");e[0]&&e[1]&&$A.rightExists(e[0],"00:00")&&$A.rightExists(e[1],"00:00")&&this.$set(t,1,e[1].replace("00:00","23:59"))},onKeydown:function(t){if(13===t.keyCode){if(t.shiftKey)return;t.preventDefault(),this.onAdd()}},addSubTask:function(){""!==this.subName.trim()&&(this.addData.subtasks.push({name:this.subName.trim(),times:[],owner:this.userId}),this.subName="")},taskPriorityContent:function(t){var e=$A.runNum(t.days);return e<=0?t.name+" ("+this.$L("无时间限制")+")":t.name+" ("+e+this.$L("天")+")"},choosePriority:function(t){var e=new Date,a=$A.runNum(t.days);if(a>0){var i=new Date((new Date).setDate(e.getDate()+a));this.$set(this.addData,"times",$A.date2string([e,i]))}else this.$set(this.addData,"times",[]);this.$set(this.addData,"p_level",t.priority),this.$set(this.addData,"p_name",t.name),this.$set(this.addData,"p_color",t.color)},defaultPriority:function(){0!==this.taskPriority.length&&(this.addData.p_name||this.choosePriority(this.taskPriority[0]))},cascaderLoadData:function(t,e){t.loading=!0,this.$store.dispatch("getColumns",t.value).then((function(a){t.children=a.map((function(t){return{value:t.id,label:t.name}})),t.loading=!1,e()})).catch((function(){t.loading=!1,e()}))},cascaderChange:function(t){t[1]&&this.$set(this.addData,"column_id",t[1])},cascaderInputChange:function(t){var e=this;this.cascaderValue=t||"",!0!==this.cascaderAlready[this.cascaderValue]&&(this.cascaderAlready[this.cascaderValue]=!0,setTimeout((function(){e.cascaderLoading++}),1e3),this.$store.dispatch("getProjects",{keys:{name:this.cascaderValue},getcolumn:"yes"}).then((function(){e.cascaderLoading--,e.initCascaderData()})).catch((function(){e.cascaderLoading--})))},setData:function(t){void 0!==t.beforeClose&&(this.beforeClose.push(t.beforeClose),delete t.beforeClose),this.addData=Object.assign({},this.addData,t)},onAdd:function(t){var e=this;this.addData.name?(this.loadIng++,this.$store.dispatch("taskAdd",this.addData).then((function(a){var i=a.msg;e.loadIng--,$A.messageSuccess(i),!0===t?(e.addData=Object.assign({},e.addData,{name:"",content:"",subtasks:[]}),e.$refs.input.focus()):(e.addData={cascader:[],name:"",content:"",owner:0,add_assist:1,column_id:0,times:[],subtasks:[],p_level:0,p_name:"",p_color:""},e.close())})).catch((function(t){var a=t.msg;e.loadIng--,$A.modalError(a)}))):$A.messageError("任务描述不能为空")},close:function(){this.$emit("input",!this.value)}}};const l=(0,a(51900).Z)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.ready?a("div",{staticClass:"task-add"},[a("div",{staticClass:"head",class:{empty:0==t.addData.cascader.length,visible:t.cascaderShow}},[a("Cascader",{attrs:{data:t.cascaderData,clearable:!1,placeholder:t.$L("请选择项目"),"load-data":t.cascaderLoadData,filterable:""},on:{"on-change":t.cascaderChange,"on-input-change":t.cascaderInputChange,"on-visible-change":function(e){t.cascaderShow=!t.cascaderShow}},model:{value:t.addData.cascader,callback:function(e){t.$set(t.addData,"cascader",e)},expression:"addData.cascader"}})],1),t._v(" "),a("div",{staticClass:"task-add-form"},[a("div",{staticClass:"title"},[a("Input",{ref:"input",attrs:{type:"textarea",rows:1,autosize:{minRows:1,maxRows:8},maxlength:255,placeholder:t.$L("任务描述")},on:{"on-keydown":t.onKeydown},model:{value:t.addData.name,callback:function(e){t.$set(t.addData,"name",e)},expression:"addData.name"}})],1),t._v(" "),a("div",{staticClass:"desc"},[a("TEditor",{attrs:{plugins:t.taskPlugins,options:t.taskOptions,"option-full":t.taskOptionFull,placeholder:t.$L(t.isDesktop?"详细描述，选填...（点击右键使用工具栏）":"详细描述，选填..."),placeholderFull:t.$L("详细描述..."),inline:""},model:{value:t.addData.content,callback:function(e){t.$set(t.addData,"content",e)},expression:"addData.content"}})],1),t._v(" "),a("div",{staticClass:"advanced-option"},[a("Button",{class:{advanced:t.advanced},on:{click:function(e){t.advanced=!t.advanced}}},[t._v(t._s(t.$L("高级选项")))]),t._v(" "),a("ul",{staticClass:"advanced-priority"},t._l(t.taskPriority,(function(e,i){return a("li",{key:i},[a("ETooltip",{attrs:{content:t.taskPriorityContent(e)}},[a("i",{staticClass:"taskfont",style:{color:e.color},domProps:{innerHTML:t._s(t.addData.p_name==e.name?"&#xe61d;":"&#xe61c;")},on:{click:function(a){return t.choosePriority(e)}}})])],1)})),0),t._v(" "),t.taskDays>0?a("DatePicker",{attrs:{open:t.taskTimeOpen,options:t.timeOptions,placeholder:t.$L("选择计划范围"),format:"yyyy/MM/dd HH:mm",type:"datetimerange",placement:"bottom"},on:{"on-change":function(e){return t.taskTimeChange(t.addData.times)},"on-open-change":t.taskTimeOpenChange},model:{value:t.addData.times,callback:function(e){t.$set(t.addData,"times",e)},expression:"addData.times"}},[a("div",{staticClass:"advanced-time",on:{click:function(e){return t.taskTimeOpenChange(!t.taskTimeOpen)}}},[a("Icon",{attrs:{type:"ios-clock-outline"}}),t._v(" "),a("em",{style:t.addData.p_color?{backgroundColor:t.addData.p_color}:{},attrs:{type:"primary"}},[t._v(t._s(t.taskDays))])],1)]):t._e()],1)]),t._v(" "),t.advanced?a("Form",{staticClass:"task-add-advanced",attrs:{"label-width":"auto"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("FormItem",{attrs:{label:t.$L("计划时间")}},[a("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("选择计划范围"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(e){return t.taskTimeChange(t.addData.times)}},model:{value:t.addData.times,callback:function(e){t.$set(t.addData,"times",e)},expression:"addData.times"}})],1),t._v(" "),a("FormItem",{attrs:{label:t.$L("任务负责人")}},[a("UserInput",{attrs:{"multiple-max":10,placeholder:t.$L("选择任务负责人"),"project-id":t.addData.project_id,transfer:!1},model:{value:t.addData.owner,callback:function(e){t.$set(t.addData,"owner",e)},expression:"addData.owner"}}),t._v(" "),t.showAddAssist?a("div",{staticClass:"task-add-assist"},[a("Checkbox",{attrs:{"true-value":1,"false-value":0},model:{value:t.addData.add_assist,callback:function(e){t.$set(t.addData,"add_assist",e)},expression:"addData.add_assist"}},[t._v(t._s(t.$L("加入任务协助人员列表")))]),t._v(" "),a("ETooltip",{attrs:{content:t.$L("你不是任务负责人时建议加入任务协助人员列表")}},[a("Icon",{attrs:{type:"ios-alert-outline"}})],1)],1):t._e()],1),t._v(" "),a("div",{staticClass:"subtasks"},[t.addData.subtasks.length>0?a("div",{staticClass:"sublist"},[a("Row",[a("Col",{attrs:{span:"12"}},[t._v(t._s(t.$L("任务描述")))]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v(t._s(t.$L("计划时间")))]),t._v(" "),a("Col",{attrs:{span:"6"}},[t._v(t._s(t.$L("负责人")))])],1),t._v(" "),t._l(t.addData.subtasks,(function(e,i){return a("Row",{key:i},[a("Col",{attrs:{span:"12"}},[a("Input",{attrs:{maxlength:255,clearable:""},on:{"on-clear":function(e){return t.addData.subtasks.splice(i,1)}},model:{value:e.name,callback:function(a){t.$set(e,"name",a)},expression:"item.name"}})],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("DatePicker",{attrs:{options:t.timeOptions,editable:!1,placeholder:t.$L("选择时间"),format:"yyyy/MM/dd HH:mm",type:"datetimerange"},on:{"on-change":function(a){return t.taskTimeChange(e.times)}},model:{value:e.times,callback:function(a){t.$set(e,"times",a)},expression:"item.times"}})],1),t._v(" "),a("Col",{attrs:{span:"6"}},[a("UserInput",{attrs:{"multiple-max":1,placeholder:t.$L("选择负责人"),"project-id":t.addData.project_id,transfer:!1},model:{value:e.owner,callback:function(a){t.$set(e,"owner",a)},expression:"item.owner"}})],1)],1)}))],2):t._e(),t._v(" "),a("Input",{class:["enter-input",""==t.subName?"empty":""],attrs:{type:"text",placeholder:t.$L("+ 输入子任务，回车添加子任务")},on:{"on-enter":t.addSubTask},model:{value:t.subName,callback:function(e){t.subName=e},expression:"subName"}})],1)],1):t._e(),t._v(" "),a("div",{staticClass:"ivu-modal-footer"},[a("div",{staticClass:"adaption"},[a("Button",{attrs:{type:"default"},on:{click:t.close}},[t._v(t._s(t.$L("取消")))]),t._v(" "),a("ButtonGroup",{staticClass:"page-manage-add-task-button-group"},[a("Button",{attrs:{type:"primary",loading:t.loadIng>0},on:{click:t.onAdd}},[t._v(t._s(t.$L("添加任务")))]),t._v(" "),a("Dropdown",{on:{"on-click":function(e){return t.onAdd(!0)}}},[a("Button",{attrs:{type:"primary"}},[a("Icon",{attrs:{type:"ios-arrow-down"}})],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{disabled:t.loadIng>0}},[t._v(t._s(t.$L("提交继续添加")))])],1)],1)],1)],1)])],1):t._e()}),[],!1,null,null,null).exports}}]);