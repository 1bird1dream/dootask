"use strict";(self.webpackChunkDooTask=self.webpackChunkDooTask||[]).push([[159],{59159:(t,e,a)=>{a.r(e),a.d(e,{default:()=>n});function s(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function o(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?s(Object(a),!0).forEach((function(e){i(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function i(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const r={data:function(){return{nowTime:Math.round((new Date).getTime()/1e3),nowInterval:null,loadIng:0,active:!1,dashboard:"today",taskLoad:{},downList:[]}},mounted:function(){var t=this;this.nowInterval=setInterval((function(){t.nowTime=Math.round((new Date).getTime()/1e3)}),1e3),this.isElectron||this.getAppInfo()},destroyed:function(){clearInterval(this.nowInterval)},activated:function(){this.getTask(),this.active=!0,this.$store.dispatch("getProjectStatistics")},deactivated:function(){this.active=!1},computed:o(o({},(0,a(20629).rn)(["userInfo","projects","projectStatistics","tasks","taskId"])),{},{title:function(){switch(this.dashboard){case"today":return this.$L("今日任务");case"overdue":return this.$L("超期任务");default:return""}},list:function(){var t=this.dashboard,e=new Date($A.formatDate("Y-m-d 00:00:00")),a=new Date($A.formatDate("Y-m-d 23:59:59")),s=$A.cloneJSON(this.tasks);return(s=s.filter((function(s){if(s.complete_at)return!1;if(!s.end_at)return!1;if(!s.owner)return!1;var o=new Date(s.start_at),i=new Date(s.end_at);switch(s._start_time=o,s._end_time=i,t){case"today":return o>=e&&o<=a||i>=e&&i<=a;case"overdue":return i<=e;default:return!1}}))).sort((function(t,e){return t._end_time-e._end_time}))},expiresFormat:function(){var t=this.nowTime;return function(e){var a=Math.round(new Date(e).getTime()/1e3)-t;return a<345600&&a>0?this.formatSeconds(a):a<=0?"-"+this.formatSeconds(-1*a):this.formatTime(e)}}}),watch:{dashboard:function(){this.getTask()},taskId:function(t){0==t&&this.active&&this.$store.dispatch("getProjectStatistics")}},methods:{getAppInfo:function(){var t=this;this.$store.dispatch("call",{url:"system/get/appinfo"}).then((function(e){var a=e.data;t.downList=a.list}))},goDownApp:function(){this.goForward({path:"/manage/download"})},getTask:function(){var t=this,e={complete:"no"};switch(this.dashboard){case"today":e.time=[$A.formatDate("Y-m-d 00:00:00"),$A.formatDate("Y-m-d 23:59:59")];break;case"overdue":e.time_before=$A.formatDate("Y-m-d 00:00:00");break;default:return}this.loadIng++,this.$store.dispatch("getTasks",e).then((function(){t.loadIng--})).catch((function(){t.loadIng--}))},dropTask:function(t,e){switch(e){case"complete":if(t.complete_at)return;this.updateTask(t,{complete_at:$A.formatDate("Y-m-d H:i:s")});break;case"uncomplete":if(!t.complete_at)return;this.updateTask(t,{complete_at:!1});break;case"archived":case"remove":this.archivedOrRemoveTask(t,e);break;default:e.name&&this.updateTask(t,{color:e.color})}},updateTask:function(t,e){var a=this;!0!==this.taskLoad[t.id]&&(this.$set(this.taskLoad,t.id,!0),Object.keys(e).forEach((function(s){return a.$set(t,s,e[s])})),this.$store.dispatch("taskUpdate",Object.assign(e,{task_id:t.id})).then((function(){a.$set(a.taskLoad,t.id,!1),a.$store.dispatch("getProjectStatistics")})).catch((function(e){var s=e.msg;$A.modalError(s),a.$set(a.taskLoad,t.id,!1),a.$store.dispatch("getTaskOne",t.id)})))},archivedOrRemoveTask:function(t,e){var a=this,s="remove"==e?"removeTask":"archivedTask",o="remove"==e?"删除":"归档",i=t.parent_id>0?"子任务":"任务";$A.modalConfirm({title:o+i,content:"你确定要"+o+i+"【"+t.name+"】吗？",loading:!0,onOk:function(){!0!==a.taskLoad[t.id]?(a.$set(a.taskLoad,t.id,!0),a.$store.dispatch(s,t.id).then((function(e){var s=e.msg;$A.messageSuccess(s),a.$Modal.remove(),a.$set(a.taskLoad,t.id,!1),a.$store.dispatch("getProjectStatistics")})).catch((function(e){var s=e.msg;$A.modalError(s,301),a.$Modal.remove(),a.$set(a.taskLoad,t.id,!1)}))):a.$Modal.remove()}})},formatTime:function(t){var e=Math.round(new Date(t).getTime()/1e3);return($A.formatDate("Ymd")===$A.formatDate("Ymd",e)?$A.formatDate("H:i",e):$A.formatDate("Y")===$A.formatDate("Y",e)?$A.formatDate("m-d",e):$A.formatDate("Y-m-d",e))||""},formatBit:function(t){return(t=+t)>9?t:"0"+t},formatSeconds:function(t){var e,a=Math.floor(t/86400),s=Math.floor(t%86400/3600),o=Math.floor(t%86400%3600/60),i=Math.floor(t%86400%3600%60);return a>0?e=s>0?a+"d,"+this.formatBit(s)+"h":o>0?a+"d,"+this.formatBit(o)+"min":i>0?a+"d,"+this.formatBit(i)+"s":a+"d":s>0?e=this.formatBit(s)+":"+this.formatBit(o)+":"+this.formatBit(i):o>0?e=this.formatBit(o)+":"+this.formatBit(i):i>0&&(e=this.formatBit(i)+"s"),e}}};const n=(0,a(51900).Z)(r,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"page-dashboard"},[a("PageTitle",{attrs:{title:t.$L("仪表盘")}}),t._v(" "),a("div",{staticClass:"dashboard-wrapper"},[a("div",{staticClass:"dashboard-hello"},[t._v(t._s(t.$L("欢迎您，"+t.userInfo.nickname)))]),t._v(" "),a("div",{staticClass:"dashboard-desc"},[t._v(t._s(t.$L("以下是你当前的任务统计数据")))]),t._v(" "),a("ul",{staticClass:"dashboard-block"},[a("li",{on:{click:function(e){t.dashboard="today"}}},[a("div",{staticClass:"block-title"},[t._v(t._s(t.$L("今日待完成")))]),t._v(" "),a("div",{staticClass:"block-data"},[a("div",{staticClass:"block-num"},[t._v(t._s(t.projectStatistics.today||0))]),t._v(" "),a("i",{staticClass:"taskfont"},[t._v("")])])]),t._v(" "),a("li",{on:{click:function(e){t.dashboard="overdue"}}},[a("div",{staticClass:"block-title"},[t._v(t._s(t.$L("超期未完成")))]),t._v(" "),a("div",{staticClass:"block-data"},[a("div",{staticClass:"block-num"},[t._v(t._s(t.projectStatistics.overdue||0))]),t._v(" "),a("i",{staticClass:"taskfont"},[t._v("")])])]),t._v(" "),a("li",[a("div",{staticClass:"block-title"},[t._v(t._s(t.$L("参与的项目")))]),t._v(" "),a("div",{staticClass:"block-data"},[a("div",{staticClass:"block-num"},[t._v(t._s(t.projects.length))]),t._v(" "),a("i",{staticClass:"taskfont"},[t._v("")])])])]),t._v(" "),t.list.length>0?[a("div",{staticClass:"dashboard-title"},[t._v(t._s(t.title))]),t._v(" "),a("ul",{staticClass:"dashboard-list overlay-y"},t._l(t.list,(function(e){return a("li",{key:e.id,style:e.color?{backgroundColor:e.color}:{},on:{click:function(a){return t.$store.dispatch("openTask",e.id)}}},[e.p_name&&0===e.parent_id?a("em",{staticClass:"priority-color",style:{backgroundColor:e.p_color}}):t._e(),t._v(" "),a("EDropdown",{attrs:{trigger:"click",size:"small",placement:"bottom"},on:{command:function(a){return t.dropTask(e,a)}}},[a("div",{staticClass:"drop-icon",on:{click:function(t){t.stopPropagation()}}},[a("i",{staticClass:"taskfont"},[t._v("")])]),t._v(" "),a("EDropdownMenu",{staticClass:"project-list-more-dropdown-menu",attrs:{slot:"dropdown"},slot:"dropdown"},[e.complete_at?a("EDropdownItem",{attrs:{command:"uncomplete"}},[a("div",{staticClass:"item red"},[a("Icon",{attrs:{type:"md-checkmark-circle-outline"}}),t._v(t._s(t.$L("标记未完成"))+"\n                                ")],1)]):a("EDropdownItem",{attrs:{command:"complete"}},[a("div",{staticClass:"item"},[a("Icon",{attrs:{type:"md-radio-button-off"}}),t._v(t._s(t.$L("完成"))+"\n                                ")],1)]),t._v(" "),0===e.parent_id?a("EDropdownItem",{attrs:{command:"archived"}},[a("div",{staticClass:"item"},[a("Icon",{attrs:{type:"ios-filing"}}),t._v(t._s(t.$L("归档"))+"\n                                ")],1)]):t._e(),t._v(" "),a("EDropdownItem",{attrs:{command:"remove"}},[a("div",{staticClass:"item"},[a("Icon",{attrs:{type:"md-trash"}}),t._v(t._s(t.$L("删除"))+"\n                                ")],1)]),t._v(" "),0===e.parent_id?[0===e.parent_id?a("EDropdownItem",{attrs:{divided:"",disabled:""}},[t._v(t._s(t.$L("背景色")))]):t._e(),t._v(" "),t._l(t.$store.state.taskColorList,(function(s,o){return a("EDropdownItem",{key:o,attrs:{command:s}},[a("div",{staticClass:"item"},[a("i",{staticClass:"taskfont",style:{color:s.color||"#f9f9f9"},domProps:{innerHTML:t._s(s.color==e.color?"&#xe61d;":"&#xe61c;")}}),t._v(t._s(t.$L(s.name))+"\n                                    ")])])}))]:t._e()],2)],1),t._v(" "),a("div",{staticClass:"item-title"},[t._v(t._s(e.name))]),t._v(" "),e.desc?a("div",{staticClass:"item-icon"},[a("i",{staticClass:"taskfont"},[t._v("")])]):t._e(),t._v(" "),e.sub_num>0?a("div",{staticClass:"item-icon"},[a("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),a("em",[t._v(t._s(e.sub_complete)+"/"+t._s(e.sub_num))])]):t._e(),t._v(" "),a("div",{class:["item-icon",e.today?"today":"",e.overdue?"overdue":""]},[a("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),a("em",[t._v(t._s(t.expiresFormat(e.end_at)))])])],1)})),0)]:t._e()],2),t._v(" "),t.downList.length>0?a("div",{staticClass:"download-app"},[a("Button",{attrs:{icon:"md-download",type:"primary"},on:{click:t.goDownApp}},[t._v(t._s(t.$L("客户端下载")))])],1):t._e()],1)}),[],!1,null,null,null).exports}}]);