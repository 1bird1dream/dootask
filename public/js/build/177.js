(self.webpackChunkDooTask=self.webpackChunkDooTask||[]).push([[177],{4177:(t,a,e)=>{"use strict";e.r(a),e.d(a,{default:()=>n});function s(t,a){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);a&&(s=s.filter((function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable}))),e.push.apply(e,s)}return e}function o(t){for(var a=1;a<arguments.length;a++){var e=null!=arguments[a]?arguments[a]:{};a%2?s(Object(e),!0).forEach((function(a){i(t,a,e[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):s(Object(e)).forEach((function(a){Object.defineProperty(t,a,Object.getOwnPropertyDescriptor(e,a))}))}return t}function i(t,a,e){return a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}const r={data:function(){return{nowTime:$A.Time(),nowInterval:null,loadIng:0,active:!1,dashboard:"today",taskLoad:{},downList:[]}},mounted:function(){var t=this;this.nowInterval=setInterval((function(){t.nowTime=$A.Time()}),1e3),this.isElectron||this.getAppInfo()},destroyed:function(){clearInterval(this.nowInterval)},activated:function(){this.getTask(),this.active=!0,this.$store.dispatch("getProjectStatistics")},deactivated:function(){this.active=!1},computed:o(o({},(0,e(20629).rn)(["userInfo","projects","projectStatistics","tasks","taskId"])),{},{title:function(){switch(this.dashboard){case"today":return this.$L("今日任务");case"overdue":return this.$L("超期任务");default:return""}},list:function(){var t=this.dashboard,a=$A.Date($A.formatDate("Y-m-d 00:00:00")),e=$A.Date($A.formatDate("Y-m-d 23:59:59")),s=$A.cloneJSON(this.tasks);return(s=s.filter((function(s){if(s.complete_at)return!1;if(!s.end_at)return!1;if(!s.owner)return!1;var o=$A.Date(s.start_at),i=$A.Date(s.end_at);switch(s._start_time=o,s._end_time=i,t){case"today":return o>=a&&o<=e||i>=a&&i<=e;case"overdue":return i<=a;default:return!1}}))).sort((function(t,a){return t._end_time-a._end_time}))},expiresFormat:function(){var t=this.nowTime;return function(a){var e=Math.round($A.Date(a).getTime()/1e3)-t;return e<345600&&e>0?this.formatSeconds(e):e<=0?"-"+this.formatSeconds(-1*e):this.formatTime(a)}}}),watch:{dashboard:function(){this.getTask()},taskId:function(t){0==t&&this.active&&this.$store.dispatch("getProjectStatistics")}},methods:{getAppInfo:function(){var t=this;this.$store.dispatch("call",{url:"system/get/appinfo"}).then((function(a){var e=a.data;t.downList=e.list}))},goDownApp:function(){this.goForward({path:"/manage/download"})},getTask:function(){var t=this,a={complete:"no"};switch(this.dashboard){case"today":a.time=[$A.formatDate("Y-m-d 00:00:00"),$A.formatDate("Y-m-d 23:59:59")];break;case"overdue":a.time_before=$A.formatDate("Y-m-d 00:00:00");break;default:return}this.loadIng++,this.$store.dispatch("getTasks",a).then((function(){t.loadIng--})).catch((function(){t.loadIng--}))},dropTask:function(t,a){switch(a){case"complete":if(t.complete_at)return;this.updateTask(t,{complete_at:$A.formatDate("Y-m-d H:i:s")});break;case"uncomplete":if(!t.complete_at)return;this.updateTask(t,{complete_at:!1});break;case"archived":case"remove":this.archivedOrRemoveTask(t,a);break;default:a.name&&this.updateTask(t,{color:a.color})}},updateTask:function(t,a){var e=this;!0!==this.taskLoad[t.id]&&(this.$set(this.taskLoad,t.id,!0),Object.keys(a).forEach((function(s){return e.$set(t,s,a[s])})),this.$store.dispatch("taskUpdate",Object.assign(a,{task_id:t.id})).then((function(){e.$set(e.taskLoad,t.id,!1),e.$store.dispatch("getProjectStatistics")})).catch((function(a){var s=a.msg;$A.modalError(s),e.$set(e.taskLoad,t.id,!1),e.$store.dispatch("getTaskOne",t.id)})))},archivedOrRemoveTask:function(t,a){var e=this,s="remove"==a?"removeTask":"archivedTask",o="remove"==a?"删除":"归档",i=t.parent_id>0?"子任务":"任务";$A.modalConfirm({title:o+i,content:"你确定要"+o+i+"【"+t.name+"】吗？",loading:!0,onOk:function(){!0!==e.taskLoad[t.id]?(e.$set(e.taskLoad,t.id,!0),e.$store.dispatch(s,t.id).then((function(a){var s=a.msg;$A.messageSuccess(s),e.$Modal.remove(),e.$set(e.taskLoad,t.id,!1),e.$store.dispatch("getProjectStatistics")})).catch((function(a){var s=a.msg;$A.modalError(s,301),e.$Modal.remove(),e.$set(e.taskLoad,t.id,!1)}))):e.$Modal.remove()}})},formatTime:function(t){var a=Math.round($A.Date(t).getTime()/1e3);return($A.formatDate("Ymd")===$A.formatDate("Ymd",a)?$A.formatDate("H:i",a):$A.formatDate("Y")===$A.formatDate("Y",a)?$A.formatDate("m-d",a):$A.formatDate("Y-m-d",a))||""},formatBit:function(t){return(t=+t)>9?t:"0"+t},formatSeconds:function(t){var a,e=Math.floor(t/86400),s=Math.floor(t%86400/3600),o=Math.floor(t%86400%3600/60),i=Math.floor(t%86400%3600%60);return e>0?a=s>0?e+"d,"+this.formatBit(s)+"h":o>0?e+"d,"+this.formatBit(o)+"min":i>0?e+"d,"+this.formatBit(i)+"s":e+"d":s>0?a=this.formatBit(s)+":"+this.formatBit(o)+":"+this.formatBit(i):o>0?a=this.formatBit(o)+":"+this.formatBit(i):i>0&&(a=this.formatBit(i)+"s"),a}}};const n=(0,e(51900).Z)(r,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"page-dashboard"},[e("PageTitle",{attrs:{title:t.$L("仪表盘")}}),t._v(" "),e("div",{staticClass:"dashboard-wrapper"},[e("div",{staticClass:"dashboard-hello"},[t._v(t._s(t.$L("欢迎您，"+t.userInfo.nickname)))]),t._v(" "),e("div",{staticClass:"dashboard-desc"},[t._v(t._s(t.$L("以下是你当前的任务统计数据")))]),t._v(" "),e("ul",{staticClass:"dashboard-block"},[e("li",{on:{click:function(a){t.dashboard="today"}}},[e("div",{staticClass:"block-title"},[t._v(t._s(t.$L("今日待完成")))]),t._v(" "),e("div",{staticClass:"block-data"},[e("div",{staticClass:"block-num"},[t._v(t._s(t.projectStatistics.today||0))]),t._v(" "),e("i",{staticClass:"taskfont"},[t._v("")])])]),t._v(" "),e("li",{on:{click:function(a){t.dashboard="overdue"}}},[e("div",{staticClass:"block-title"},[t._v(t._s(t.$L("超期未完成")))]),t._v(" "),e("div",{staticClass:"block-data"},[e("div",{staticClass:"block-num"},[t._v(t._s(t.projectStatistics.overdue||0))]),t._v(" "),e("i",{staticClass:"taskfont"},[t._v("")])])]),t._v(" "),e("li",[e("div",{staticClass:"block-title"},[t._v(t._s(t.$L("参与的项目")))]),t._v(" "),e("div",{staticClass:"block-data"},[e("div",{staticClass:"block-num"},[t._v(t._s(t.projects.length))]),t._v(" "),e("i",{staticClass:"taskfont"},[t._v("")])])])]),t._v(" "),t.list.length>0?[e("div",{staticClass:"dashboard-title"},[t._v(t._s(t.title))]),t._v(" "),e("ul",{staticClass:"dashboard-list overlay-y"},t._l(t.list,(function(a){return e("li",{key:a.id,style:a.color?{backgroundColor:a.color}:{},on:{click:function(e){return t.$store.dispatch("openTask",a.id)}}},[a.p_name&&0===a.parent_id?e("em",{staticClass:"priority-color",style:{backgroundColor:a.p_color}}):t._e(),t._v(" "),e("EDropdown",{attrs:{trigger:"click",size:"small",placement:"bottom"},on:{command:function(e){return t.dropTask(a,e)}}},[e("div",{staticClass:"drop-icon",on:{click:function(t){t.stopPropagation()}}},[e("i",{staticClass:"taskfont"},[t._v("")])]),t._v(" "),e("EDropdownMenu",{staticClass:"project-list-more-dropdown-menu",attrs:{slot:"dropdown"},slot:"dropdown"},[a.complete_at?e("EDropdownItem",{attrs:{command:"uncomplete"}},[e("div",{staticClass:"item red"},[e("Icon",{attrs:{type:"md-checkmark-circle-outline"}}),t._v(t._s(t.$L("标记未完成"))+"\n                                ")],1)]):e("EDropdownItem",{attrs:{command:"complete"}},[e("div",{staticClass:"item"},[e("Icon",{attrs:{type:"md-radio-button-off"}}),t._v(t._s(t.$L("完成"))+"\n                                ")],1)]),t._v(" "),0===a.parent_id?e("EDropdownItem",{attrs:{command:"archived"}},[e("div",{staticClass:"item"},[e("Icon",{attrs:{type:"ios-filing"}}),t._v(t._s(t.$L("归档"))+"\n                                ")],1)]):t._e(),t._v(" "),e("EDropdownItem",{attrs:{command:"remove"}},[e("div",{staticClass:"item"},[e("Icon",{attrs:{type:"md-trash"}}),t._v(t._s(t.$L("删除"))+"\n                                ")],1)]),t._v(" "),0===a.parent_id?[0===a.parent_id?e("EDropdownItem",{attrs:{divided:"",disabled:""}},[t._v(t._s(t.$L("背景色")))]):t._e(),t._v(" "),t._l(t.$store.state.taskColorList,(function(s,o){return e("EDropdownItem",{key:o,attrs:{command:s}},[e("div",{staticClass:"item"},[e("i",{staticClass:"taskfont",style:{color:s.color||"#f9f9f9"},domProps:{innerHTML:t._s(s.color==a.color?"&#xe61d;":"&#xe61c;")}}),t._v(t._s(t.$L(s.name))+"\n                                    ")])])}))]:t._e()],2)],1),t._v(" "),e("div",{staticClass:"item-title"},[t._v(t._s(a.name))]),t._v(" "),a.desc?e("div",{staticClass:"item-icon"},[e("i",{staticClass:"taskfont"},[t._v("")])]):t._e(),t._v(" "),a.sub_num>0?e("div",{staticClass:"item-icon"},[e("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),e("em",[t._v(t._s(a.sub_complete)+"/"+t._s(a.sub_num))])]):t._e(),t._v(" "),e("div",{class:["item-icon",a.today?"today":"",a.overdue?"overdue":""]},[e("i",{staticClass:"taskfont"},[t._v("")]),t._v(" "),e("em",[t._v(t._s(t.expiresFormat(a.end_at)))])])],1)})),0)]:t._e()],2),t._v(" "),t.downList.length>0?e("div",{staticClass:"download-app"},[e("Button",{attrs:{icon:"md-download",type:"primary"},on:{click:t.goDownApp}},[t._v(t._s(t.$L("客户端下载")))])],1):t._e()],1)}),[],!1,null,null,null).exports}}]);