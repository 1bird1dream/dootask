import{D as r}from"./index.94197670.js";import{n as l,k as c,a as p}from"./app.1d574d8b.js";var d=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"setting-item submit"},[t("Row",{staticClass:"approve-row",attrs:{gutter:8}},e._l(e.list,function(s,o){return t("Col",{attrs:{xxl:{span:6},xl:{span:8},lg:{span:12},sm:{span:24},xs:{span:24}}},[t("div",{staticClass:"approve-col-box approve-col-for",on:{click:function(i){return e.edit(s)}}},[t("p",[e._v(e._s(e.$L("\u6D41\u7A0B\u540D\u79F0"))+"\uFF1A"),t("span",{staticStyle:{"font-weight":"500",color:"#135de6"}},[e._v(e._s(e.$L(s.name)))])]),t("Divider",{staticStyle:{margin:"12px 0"}}),t("div",{staticClass:"approve-button-box",on:{click:function(i){return i.stopPropagation(),e.edit(s)}}},[t("p",[e._v(e._s(e.$L("\u662F\u5426\u53D1\u5E03"))+"\uFF1A ")]),t("p",{on:{click:function(i){i.stopPropagation(),s.issue||e.edit(s)}}},[t("i-switch",{attrs:{disabled:!0},on:{"on-change":function(i){return e.change(s)}},model:{value:s.issue,callback:function(i){e.$set(s,"issue",i)},expression:"item.issue"}})],1)])],1)])}),1),t("DrawerOverlay",{attrs:{placement:"right",size:1200},model:{value:e.approvalSettingShow,callback:function(s){e.approvalSettingShow=s},expression:"approvalSettingShow"}},[t("iframe",{attrs:{src:e.iframeSrc}})])],1)},u=[];const v={name:"approve",components:{DrawerOverlay:r},data(){return{value:!1,loadIng:0,approvalSettingShow:!1,iframeSrc:"",name:"",list:[{id:0,name:"\u8BF7\u5047",issue:!1,version:""},{id:0,name:"\u52A0\u73ED\u7533\u8BF7",issue:!1,version:""}]}},watch:{approvalSettingShow(e){e&&(this.iframeSrc=`/workflow/#/?name=${this.name}&token=${c.userToken}&lang=${p}`)}},mounted(){window.addEventListener("message",this.saveSuccess),this.getList()},beforeDestroy(){window.removeEventListener("message",this.saveSuccess)},methods:{getList(){this.$store.dispatch("call",{url:"workflow/procdef/all",method:"post"}).then(({data:e})=>{e.rows.forEach((a,t)=>{this.list.forEach((s,o)=>{s.name==a.name&&(s.issue=!0,s.id=a.id,s.version=a.version)})})}).catch(({msg:e})=>{$A.modalError(e)}).finally(e=>{this.loadIng--})},saveSuccess(e){typeof e.data=="string"&&JSON.parse(e.data).method=="saveSuccess"&&(this.getList(),this.list.forEach((t,s)=>{t.name==this.name&&(t.issue=!0,this.$set(this.list,s,t))}),this.approvalSettingShow=!1,$A.messageSuccess("\u53D1\u5E03\u6210\u529F"))},add(){this.name="\u8BF7\u5047",this.approvalSettingShow=!0},edit(e){this.name=e.name,this.approvalSettingShow=!0},change(e){this.$nextTick(()=>{e.issue=!0,$A.modalConfirm({title:"\u53D6\u6D88\u53D1\u5E03",content:"\u5C06\u4F1A\u6E05\u7A7A\u6D41\u7A0B\u6570\u636E\uFF0C\u786E\u5B9A\u8981\u53D6\u6D88\u53D1\u5E03\uFF1F",onOk:()=>{this.del(e)}})})},del(e){if(!e.id)return e.issue=!1,!0;this.$store.dispatch("call",{url:"workflow/procdef/del",data:{id:e.id},method:"post"}).then(({data:a})=>{e.issue=!1,$A.messageSuccess("\u6210\u529F")}).catch(({msg:a})=>{$A.modalError(a)}).finally(a=>{this.loadIng--})}}},n={};var h=l(v,d,u,!1,f,"4ed9da0d",null,null);function f(e){for(let a in n)this[a]=n[a]}var g=function(){return h.exports}();export{g as default};
